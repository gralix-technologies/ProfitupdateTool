import{r as v,j as e,L as g}from"./app-BkeQkwCz.js";import{I as N}from"./IconTrash-DY-55J-g.js";import{I as b}from"./IconPlus-Cs3MX6an.js";function y({fieldDefinitions:i,fieldTypes:h,onChange:n}){const[o,u]=v.useState(i||[]);v.useEffect(()=>{i&&i.length>0&&u(i)},[i]);const r=s=>{u(s),n(s)},p=()=>{const s={name:"",type:"Text",required:!1};r([...o,s])},x=s=>{const a=o.filter((c,t)=>t!==s);r(a)},m=(s,a,c)=>{const t=[...o];t[s]={...t[s],[a]:c},a==="type"&&(c!=="Lookup"?delete t[s].options:(!t[s].options||t[s].options.length===0)&&(t[s].options=[""])),r(t)},d=s=>{const a=[...o];a[s].options||(a[s].options=[]),a[s].options.push(""),r(a)},j=(s,a,c)=>{const t=[...o];t[s].options[a]=c,r(t)},l=(s,a)=>{const c=[...o];c[s].options.splice(a,1),r(c)};return e.jsxs("div",{children:[o.map((s,a)=>e.jsxs("div",{className:"border rounded p-3 mb-2 bg-light",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("h6",{className:"mb-0 text-primary",children:["Field ",a+1]}),e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>x(a),children:e.jsx(N,{size:14})})]}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"form-label small",children:"Name"}),e.jsx("input",{type:"text",className:"form-control form-control-sm",value:s.name||"",onChange:c=>m(a,"name",c.target.value),placeholder:"customer_id"})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"form-label small",children:"Label"}),e.jsx("input",{type:"text",className:"form-control form-control-sm",value:s.label||"",onChange:c=>m(a,"label",c.target.value),placeholder:"Customer ID"})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"form-label small",children:"Type"}),e.jsx("select",{className:"form-select form-select-sm",value:s.type||"Text",onChange:c=>m(a,"type",c.target.value),children:(h||[]).map(c=>e.jsx("option",{value:c,children:c},c))})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"form-label small",children:"Required"}),e.jsx("div",{className:"form-check form-switch",children:e.jsx("input",{className:"form-check-input",type:"checkbox",checked:s.required||!1,onChange:c=>m(a,"required",c.target.checked)})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label small",children:"Description"}),e.jsx("input",{type:"text",className:"form-control form-control-sm",value:s.description||"",onChange:c=>m(a,"description",c.target.value),placeholder:"Brief description"})]})]}),s.type==="Lookup"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-1",children:[e.jsx("label",{className:"form-label small mb-0",children:"Lookup Options"}),e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>d(a),children:[e.jsx(b,{size:12,className:"me-1"}),"Add"]})]}),e.jsx("div",{className:"row g-1",children:(s.options||[]).map((c,t)=>e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"input-group input-group-sm",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",value:c,onChange:f=>j(a,t,f.target.value),placeholder:`Option ${t+1}`}),e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>l(a,t),children:e.jsx(N,{size:12})})]})},t))}),(!s.options||s.options.length===0)&&e.jsx("div",{className:"alert alert-warning alert-sm mt-1 py-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Lookup fields require at least one option"}),e.jsx("br",{}),e.jsx("small",{children:'Click "Add" to add options for this field'})]})]})})]})]},a)),e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:p,children:[e.jsx(b,{size:14,className:"me-1"}),"Add Field"]}),o.length===0&&e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(b,{size:32,className:"mb-2"}),e.jsx("p",{className:"mb-0",children:"No field definitions yet"}),e.jsx("small",{children:'Click "Add Field" to define the data structure'})]})]})}function _({data:i,setData:h,errors:n={},categories:o,field_types:u,processing:r=!1,submitText:p="Save Product",cancelUrl:x="/products",onSubmit:m}){const d=(l,s)=>{h(l,s)},j=l=>{h("field_definitions",l)};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title text-dark",children:"Product Information"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-lg-4 col-md-6",children:e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label required",children:"Product Name"}),e.jsx("input",{type:"text",className:`form-control ${n.name?"is-invalid":""}`,value:i.name,onChange:l=>d("name",l.target.value),placeholder:"Enter product name"}),n.name&&e.jsx("div",{className:"invalid-feedback",children:n.name})]})}),e.jsx("div",{className:"col-lg-4 col-md-6",children:e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label required",children:"Category"}),e.jsxs("select",{className:`form-select ${n.category?"is-invalid":""}`,value:i.category,onChange:l=>d("category",l.target.value),children:[e.jsx("option",{value:"",children:"Select category"}),o.map(l=>e.jsx("option",{value:l,children:l},l))]}),n.category&&e.jsx("div",{className:"invalid-feedback",children:n.category})]})}),e.jsx("div",{className:"col-lg-4 col-md-12",children:e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("div",{className:"form-check form-switch mt-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:i.is_active,onChange:l=>d("is_active",l.target.checked)}),e.jsx("span",{className:"form-check-label",children:"Active Product"})]}),e.jsx("div",{className:"form-hint",children:"Active products are available for use in the system."})]})})]}),e.jsx("div",{className:"row g-3 mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:"form-control",rows:"3",value:i.description,onChange:l=>d("description",l.target.value),placeholder:"Enter product description"}),e.jsx("div",{className:"form-hint",children:"Provide a detailed description of the product and its purpose."})]})})}),e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-lg-6 col-md-8",children:e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label required",children:"Portfolio Value Field"}),e.jsxs("select",{className:`form-select ${n.portfolio_value_field?"is-invalid":""}`,value:i.portfolio_value_field||"",onChange:l=>d("portfolio_value_field",l.target.value),children:[e.jsx("option",{value:"",children:"Select field for portfolio value"}),(i.field_definitions||[]).filter(l=>{if(!l||!l.type)return!1;const s=(l.type||"").toLowerCase();return["numeric","number","decimal","integer","float"].includes(s)}).map((l,s)=>e.jsxs("option",{value:l.name,children:[l.name," - ",l.label||l.description||"No label"," (",l.type,")"]},`pvf-${l.name}-${s}`))]}),e.jsx("div",{className:"form-hint",children:"This numeric field will be summed to calculate total portfolio value. Examples: outstanding_balance, balance, principal_amount"}),n.portfolio_value_field&&e.jsx("div",{className:"invalid-feedback",children:n.portfolio_value_field})]})}),e.jsx("div",{className:"col-lg-6 col-md-4",children:e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"form-label",children:"Quick Actions"}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>d("category","Loan"),children:"Set as Loan Product"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>d("category","Deposit"),children:"Set as Deposit Product"})]})]})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header py-2",children:[e.jsx("h5",{className:"card-title text-dark mb-0",children:"Field Definitions"}),e.jsx("div",{className:"card-subtitle text-muted small",children:"Define the data fields for this product"})]}),e.jsx("div",{className:"card-body py-3",style:{maxHeight:"400px",overflowY:"auto"},children:e.jsx(y,{fieldDefinitions:i.field_definitions,fieldTypes:u,onChange:j})})]})})}),e.jsx("div",{className:"card-footer bg-transparent mt-auto",children:e.jsxs("div",{className:"btn-list justify-content-end",children:[e.jsx(g,{href:x,className:"btn",children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",disabled:r,onClick:m,children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Saving..."]}):p})]})})]})]})}export{_ as P};
