import{r as i,e as U,j as e,d as M,v as Y,b as G}from"./app-BkeQkwCz.js";import{h as J,A as K,b as R}from"./AppLayout-QgBVyLMh.js";import{I as D}from"./IconUpload-DI1O2urB.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M12 8l0 4l2 2",key:"svg-0"}],["path",{d:"M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5",key:"svg-1"}]],Z=J("outline","history","History",X),Q=({products:j,onUploadStart:v,onUploadComplete:g,onUploadError:a})=>{var B;const[c,o]=i.useState(null),[n,x]=i.useState(null),[y,L]=i.useState(!1),[t,N]=i.useState(!1),[f,d]=i.useState(null),[l,m]=i.useState(!1),[w,b]=i.useState(!1),C=i.useRef(null),{data:u,setData:F,errors:S,setError:q,clearErrors:I}=U({product_id:"",mode:"append"}),$=s=>{const r=s.target.files[0];o(r),x(null),I(),r&&u.product_id&&H(r)},T=s=>{const r=s.target.value;F("product_id",r),x(null),d(null),I(),r&&W(r),c&&r&&H(c)},W=async s=>{m(!0);try{const r=await M.get("/api/data/field-requirements",{params:{product_id:s}});d(r.data.field_requirements)}catch(r){console.error("Failed to load field requirements:",r)}finally{m(!1)}},P=async()=>{if(!u.product_id){a==null||a("Please select a product first");return}b(!0);try{const s=await M.get("/api/data/sample-file",{params:{product_id:u.product_id,rows:5},responseType:"blob",timeout:3e4});if(s.data.type==="application/json"){const z=await s.data.text(),V=JSON.parse(z);throw new Error(V.message||"Failed to generate sample file")}const r=window.URL.createObjectURL(new Blob([s.data],{type:"text/csv"})),h=document.createElement("a");h.href=r;const p=j.find(z=>z.id==u.product_id),_=`sample_${p?p.name.replace(/[^a-zA-Z0-9]/g,"_"):"product"}_${new Date().toISOString().split("T")[0]}.csv`;h.setAttribute("download",_),document.body.appendChild(h),h.click(),setTimeout(()=>{h.remove(),window.URL.revokeObjectURL(r)},100),console.log("âœ“ Sample file downloaded successfully:",_)}catch(s){console.error("Failed to download sample file:",s);let r="Failed to download sample file";s.response?s.response.status===404?r="Sample file endpoint not found. Please contact support.":s.response.status===403?r="Permission denied. You may not have access to download sample files.":s.response.status===500?r="Server error generating sample file. Please try again or contact support.":s.response.data&&s.response.data.message&&(r=s.response.data.message):s.request?r="No response from server. Please check your connection.":r=s.message||"Failed to download sample file",a==null||a(r)}finally{b(!1)}},H=async s=>{var h,p;if(!s||!u.product_id)return;L(!0);const r=new FormData;r.append("file",s),r.append("product_id",u.product_id);try{const k=await M.post("/api/data/validate-file",r,{headers:{"Content-Type":"multipart/form-data"}});x(k.data),I()}catch(k){const _=((p=(h=k.response)==null?void 0:h.data)==null?void 0:p.message)||"File validation failed";q("file",_),x(null)}finally{L(!1)}},O=async()=>{var h,p;if(!c||!u.product_id||!(n!=null&&n.success))return;if(!Y()){console.error("CSRF token not available for file upload"),a("CSRF token not available. Please refresh the page.");return}N(!0);const s=new FormData;s.append("file",c),s.append("product_id",u.product_id),s.append("mode",u.mode);const r=G();r&&s.append("_token",r);try{const k=await M.post("/api/data/upload",s,{headers:{"Content-Type":"multipart/form-data"}});k.data.success&&(v==null||v(k.data),o(null),x(null),F({product_id:"",mode:"append"}),C.current&&(C.current.value=""))}catch(k){const _=((p=(h=k.response)==null?void 0:h.data)==null?void 0:p.message)||"Upload failed";a==null||a(_)}finally{N(!1)}},A=s=>{if(s===0)return"0 Bytes";const r=1024,h=["Bytes","KB","MB","GB"],p=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,p)).toFixed(2))+" "+h[p]};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Upload CSV Data"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Select Product"}),e.jsxs("select",{className:`form-select ${S.product_id?"is-invalid":""}`,value:u.product_id,onChange:T,disabled:t,children:[e.jsx("option",{value:"",children:"Choose a product..."}),j.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.category,")"]},s.id))]}),S.product_id&&e.jsx("div",{className:"invalid-feedback",children:S.product_id})]}),u.product_id&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("label",{className:"form-label mb-0",children:"Field Requirements"}),e.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:P,disabled:w||l,children:w?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),"Downloading..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon me-1",width:"16",height:"16",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2"}),e.jsx("path",{d:"M7 11l5 5l5 -5"}),e.jsx("path",{d:"M12 4v12"})]}),"Download Sample"]})})]}),l?e.jsxs("div",{className:"text-center py-3",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Loading field requirements..."]}):f?e.jsx("div",{className:"card card-sm",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"row",children:f.map((s,r)=>e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:`badge me-2 ${s.required?"bg-red":"bg-blue"}`,children:s.required?"Required":"Optional"}),e.jsx("span",{className:"font-weight-medium",children:s.name}),e.jsxs("span",{className:"text-muted ms-2",children:["(",s.type,")"]})]}),s.description&&e.jsx("small",{className:"text-muted d-block",children:s.description}),s.options&&e.jsxs("small",{className:"text-muted d-block",children:["Options: ",s.options.join(", ")]}),s.constraints&&e.jsxs("small",{className:"text-muted d-block",children:["Constraints: ",Object.entries(s.constraints).map(([h,p])=>`${h}: ${p}`).join(", ")]})]},r))})})}):null]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Import Mode"}),e.jsxs("div",{className:"form-selectgroup",children:[e.jsxs("label",{className:"form-selectgroup-item",children:[e.jsx("input",{type:"radio",name:"mode",value:"append",className:"form-selectgroup-input",checked:u.mode==="append",onChange:s=>F("mode",s.target.value),disabled:t}),e.jsxs("span",{className:"form-selectgroup-label",children:[e.jsx("span",{className:"form-selectgroup-title",children:"Append"}),e.jsx("span",{className:"form-selectgroup-text",children:"Add new data to existing records"})]})]}),e.jsxs("label",{className:"form-selectgroup-item",children:[e.jsx("input",{type:"radio",name:"mode",value:"overwrite",className:"form-selectgroup-input",checked:u.mode==="overwrite",onChange:s=>F("mode",s.target.value),disabled:t}),e.jsxs("span",{className:"form-selectgroup-label",children:[e.jsx("span",{className:"form-selectgroup-title",children:"Overwrite"}),e.jsx("span",{className:"form-selectgroup-text",children:"Replace all existing data"})]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"CSV File"}),e.jsx("input",{ref:C,type:"file",className:`form-control ${S.file?"is-invalid":""}`,accept:".csv,.txt",onChange:$,disabled:t}),S.file&&e.jsx("div",{className:"invalid-feedback",children:S.file}),e.jsx("div",{className:"form-hint",children:"Maximum file size: 200MB. Supported formats: CSV, TXT"})]}),c&&e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"card card-sm",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-auto",children:e.jsx("span",{className:"bg-blue text-white avatar",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"}),e.jsx("path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"})]})})}),e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"font-weight-medium",children:c.name}),e.jsx("div",{className:"text-muted",children:A(c.size)})]}),y&&e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"spinner-border spinner-border-sm text-blue",role:"status"})})]})})})}),n&&e.jsx("div",{className:"mb-3",children:n.success?e.jsx("div",{className:"alert alert-success",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon alert-icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M5 12l5 5l10 -10"})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"alert-title",children:"File validation passed!"}),e.jsxs("div",{className:"text-muted",children:["Headers found: ",(B=n.headers)==null?void 0:B.join(", ")]})]})]})}):e.jsx("div",{className:"alert alert-danger",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon alert-icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M10.29 3.86l-1.82 -1.82a2 2 0 0 0 -2.83 0l-1.82 1.82a2 2 0 0 0 0 2.83l1.82 1.82"}),e.jsx("path",{d:"M13.71 20.14l1.82 1.82a2 2 0 0 0 2.83 0l1.82 -1.82a2 2 0 0 0 0 -2.83l-1.82 -1.82"})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"alert-title",children:"File validation failed"}),e.jsx("div",{className:"text-muted",children:n.message})]})]})})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:O,disabled:!c||!u.product_id||!(n!=null&&n.success)||t,children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Starting Upload..."]}):"Start Import"})})]})]})},E=({importId:j,onComplete:v,onError:g})=>{var f;const[a,c]=i.useState(null),[o,n]=i.useState(!0),[x,y]=i.useState(null);i.useEffect(()=>{if(!j)return;const d=async()=>{var m,w;try{const b=await M.get(`/api/data/progress/${j}`);b.data.success&&(c(b.data.progress),y(null),b.data.progress.status==="completed"?v==null||v(b.data.progress):b.data.progress.status==="failed"&&(g==null||g(b.data.progress.message)))}catch(b){const C=((w=(m=b.response)==null?void 0:m.data)==null?void 0:w.message)||"Failed to fetch progress";y(C),g==null||g(C)}finally{n(!1)}};d();let l=null;return((a==null?void 0:a.status)==="processing"||(a==null?void 0:a.status)==="queued")&&(l=setInterval(()=>{d()},2e3)),()=>{l&&clearInterval(l)}},[j,a==null?void 0:a.status]);const L=async()=>{var d,l;try{(await M.post(`/api/data/cancel/${j}`)).data.success&&c(w=>({...w,status:"cancelled",message:"Import cancelled by user"}))}catch(m){const w=((l=(d=m.response)==null?void 0:d.data)==null?void 0:l.message)||"Failed to cancel import";y(w)}},t=d=>{switch(d){case"queued":return"info";case"processing":return"primary";case"completed":return"success";case"failed":return"danger";case"cancelled":return"warning";default:return"secondary"}},N=d=>{switch(d){case"queued":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"}),e.jsx("polyline",{points:"12,7 12,12 15,15"})]});case"processing":return e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})});case"completed":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M5 12l5 5l10 -10"})]});case"failed":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M18 6l-12 12"}),e.jsx("path",{d:"M6 6l12 12"})]});case"cancelled":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"}),e.jsx("path",{d:"M9 12l6 0"})]});default:return null}};return o?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"mt-2",children:"Loading import progress..."})]})}):x?e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"alert alert-danger",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon alert-icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"alert-title",children:"Error"}),e.jsx("div",{className:"text-muted",children:x})]})]})})})}):a?e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:"Import Progress"}),e.jsx("div",{className:"card-actions",children:e.jsx("span",{className:`badge bg-${t(a.status)}`,children:a.status.toUpperCase()})})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col",children:e.jsx("div",{className:"progress",children:e.jsx("div",{className:`progress-bar bg-${t(a.status)}`,role:"progressbar",style:{width:`${a.percent}%`},"aria-valuenow":a.percent,"aria-valuemin":"0","aria-valuemax":"100",children:a.percent>10&&`${Math.round(a.percent)}%`})})}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:`text-${t(a.status)}`,children:N(a.status)})})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-muted",children:a.message}),e.jsxs("div",{className:"small text-muted",children:["Last updated: ",new Date(a.updated_at).toLocaleString()]})]}),a.data&&Object.keys(a.data).length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"card-title",children:"Import Details"}),e.jsxs("div",{className:"row",children:[a.data.total_rows&&e.jsx("div",{className:"col-sm-6",children:e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Total Rows:"})," ",a.data.total_rows.toLocaleString()]})}),a.data.error_count!==void 0&&e.jsx("div",{className:"col-sm-6",children:e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Errors:"}),e.jsx("span",{className:a.data.error_count>0?"text-danger":"text-success",children:a.data.error_count.toLocaleString()})]})})]})]}),((f=a.data)==null?void 0:f.errors)&&a.data.errors.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"card-title",children:"Import Errors"}),e.jsx("div",{className:"alert alert-warning",children:e.jsxs("div",{className:"small",children:[e.jsx("strong",{children:"First 10 errors:"}),e.jsx("ul",{className:"mb-0 mt-1",children:a.data.errors.slice(0,10).map((d,l)=>e.jsx("li",{children:d},l))}),a.data.errors.length>10&&e.jsx("div",{className:"mt-1",children:e.jsxs("em",{children:["... and ",a.data.errors.length-10," more errors"]})})]})})]}),e.jsx("div",{className:"d-flex justify-content-end",children:(a.status==="processing"||a.status==="queued")&&e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:L,children:"Cancel Import"})})]})]}):e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body text-center text-muted",children:"No import progress found"})})},ee=({onSelectImport:j})=>{const[v,g]=i.useState([]),[a,c]=i.useState(!0),[o,n]=i.useState(null);i.useEffect(()=>{x()},[]);const x=async()=>{var t,N;try{c(!0);const f=await M.get("/api/data/imports");f.data.success&&(g(f.data.imports),n(null))}catch(f){const d=((N=(t=f.response)==null?void 0:t.data)==null?void 0:N.message)||"Failed to fetch import history";n(d)}finally{c(!1)}},y=t=>{switch(t){case"queued":return"info";case"processing":return"primary";case"completed":return"success";case"failed":return"danger";case"cancelled":return"warning";default:return"secondary"}},L=t=>{switch(t){case"queued":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-sm",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"}),e.jsx("polyline",{points:"12,7 12,12 15,15"})]});case"processing":return e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})});case"completed":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-sm",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M5 12l5 5l10 -10"})]});case"failed":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-sm",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M18 6l-12 12"}),e.jsx("path",{d:"M6 6l12 12"})]});case"cancelled":return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-sm",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"}),e.jsx("path",{d:"M9 12l6 0"})]});default:return null}};return a?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Import History"})}),e.jsxs("div",{className:"card-body text-center",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"mt-2",children:"Loading import history..."})]})]}):o?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Import History"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"alert alert-danger",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon alert-icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"alert-title",children:"Error"}),e.jsx("div",{className:"text-muted",children:o})]})]})}),e.jsx("button",{className:"btn btn-outline-primary",onClick:x,children:"Retry"})]})]}):e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:"Import History"}),e.jsx("div",{className:"card-actions",children:e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:x,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"}),e.jsx("path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"})]}),"Refresh"]})})]}),e.jsx("div",{className:"card-body",children:v.length===0?e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-lg mb-2",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"}),e.jsx("path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"})]}),e.jsx("div",{children:"No imports found"}),e.jsx("div",{className:"small",children:"Upload your first CSV file to get started"})]}):e.jsx("div",{className:"list-group list-group-flush",children:v.map(t=>{var N;return e.jsx("div",{className:"list-group-item list-group-item-action cursor-pointer",onClick:()=>j==null?void 0:j(t.import_id),children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-auto",children:e.jsx("span",{className:`badge bg-${y(t.status)}`,children:L(t.status)})}),e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-weight-medium",children:["Import #",t.import_id.slice(0,8),"..."]}),e.jsxs("div",{className:"text-muted small",children:["Product ID: ",t.product_id]}),e.jsx("div",{className:"text-muted small",children:new Date(t.updated_at).toLocaleString()})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:`badge bg-${y(t.status)}`,children:t.status.toUpperCase()}),t.percent>0&&e.jsxs("div",{className:"small text-muted mt-1",children:[Math.round(t.percent),"%"]})]})]}),e.jsx("div",{className:"text-muted small mt-1",children:t.message}),((N=t.data)==null?void 0:N.total_rows)&&e.jsxs("div",{className:"small text-muted",children:["Rows: ",t.data.total_rows.toLocaleString(),t.data.error_count>0&&e.jsxs("span",{className:"text-danger",children:[" ","(",t.data.error_count," errors)"]})]})]})]})},t.import_id)})})})]})};function re({auth:j,products:v}){const[g,a]=i.useState(null),[c,o]=i.useState(null),n=i.useRef([]),x=()=>{n.current.forEach(l=>{l&&clearTimeout(l)}),n.current=[]};i.useEffect(()=>()=>{x()},[]);const y=l=>{a(l.import_id),o({type:"success",message:"File upload started successfully! You can monitor the progress below."});const m=setTimeout(()=>o(null),5e3);n.current.push(m)},L=l=>{o({type:"error",message:l});const m=setTimeout(()=>o(null),1e4);n.current.push(m)},t=l=>{var w;o({type:"success",message:`Import completed successfully! Processed ${((w=l.data)==null?void 0:w.total_rows)||0} rows.`});const m=setTimeout(()=>o(null),1e4);n.current.push(m)},N=l=>{o({type:"error",message:`Import failed: ${l}`});const m=setTimeout(()=>o(null),1e4);n.current.push(m)},f=l=>{a(l)},d=()=>{o(null)};return e.jsxs(K,{title:"Data Ingestion",children:[e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-xl",children:e.jsx("div",{className:"row g-2 align-items-center",children:e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"page-pretitle",children:"Data Management"}),e.jsx("h2",{className:"page-title",children:"Data Ingestion"})]})})})}),e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"container-xl",children:[c&&e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:`alert alert-${c.type==="error"?"danger":"success"} alert-dismissible`,children:[e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{children:c.type==="error"?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon alert-icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon alert-icon",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M5 12l5 5l10 -10"})]})}),e.jsx("div",{children:c.message})]}),e.jsx("button",{type:"button",className:"btn-close",onClick:d,"aria-label":"Close"})]})})}),e.jsxs("div",{className:"row row-deck row-cards",children:[e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(D,{size:18,className:"me-2"}),"Upload Data"]})}),e.jsx("div",{className:"card-body",children:e.jsx(Q,{products:v,onUploadStart:y,onUploadComplete:t,onUploadError:L})})]})}),e.jsx("div",{className:"col-lg-6",children:g?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(R,{size:18,className:"me-2"}),"Import Progress"]})}),e.jsx("div",{className:"card-body",children:e.jsx(E,{importId:g,onComplete:t,onError:N})})]}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(R,{size:18,className:"me-2"}),"Import Progress"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"empty",children:[e.jsx("div",{className:"empty-img",children:e.jsx(D,{size:48,className:"text-muted"})}),e.jsx("p",{className:"empty-title",children:"Upload a file to see progress"}),e.jsx("p",{className:"empty-subtitle text-muted",children:"Select a product and CSV file to get started"})]})})]})})]}),e.jsx("div",{className:"row row-deck row-cards",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(Z,{size:18,className:"me-2"}),"Import History"]})}),e.jsx("div",{className:"card-body",children:e.jsx(ee,{onSelectImport:f})})]})})})]})})]})}export{re as default};
