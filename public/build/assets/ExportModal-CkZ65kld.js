import{r as i,j as e}from"./app-BkeQkwCz.js";import{I as T}from"./IconFilter-DpaF_UhO.js";import{h as z,o as P,e as U,f as B}from"./AppLayout-QgBVyLMh.js";import{I as L}from"./IconRefresh-U6chIQJB.js";import{I as q}from"./IconCalendar-C52FWICz.js";import{I as G}from"./IconCurrencyDollar-DCDJ1xJI.js";import{I as A}from"./IconDownload-DpSVhOrW.js";import{I as H}from"./IconAlertCircle-WImK9GUn.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M3 21l18 0",key:"svg-0"}],["path",{d:"M9 8l1 0",key:"svg-1"}],["path",{d:"M9 12l1 0",key:"svg-2"}],["path",{d:"M9 16l1 0",key:"svg-3"}],["path",{d:"M14 8l1 0",key:"svg-4"}],["path",{d:"M14 12l1 0",key:"svg-5"}],["path",{d:"M14 16l1 0",key:"svg-6"}],["path",{d:"M5 21v-16a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v16",key:"svg-7"}]],O=z("outline","building","Building",J);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M4 4h6v6h-6z",key:"svg-0"}],["path",{d:"M14 4h6v6h-6z",key:"svg-1"}],["path",{d:"M4 14h6v6h-6z",key:"svg-2"}],["path",{d:"M17 17m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-3"}]],X=z("outline","category","Category",V);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M7 16.5a1.5 1.5 0 0 0 -3 0v3a1.5 1.5 0 0 0 3 0",key:"svg-2"}],["path",{d:"M10 20.25c0 .414 .336 .75 .75 .75h1.25a1 1 0 0 0 1 -1v-1a1 1 0 0 0 -1 -1h-1a1 1 0 0 1 -1 -1v-1a1 1 0 0 1 1 -1h1.25a.75 .75 0 0 1 .75 .75",key:"svg-3"}],["path",{d:"M16 15l2 6l2 -6",key:"svg-4"}]],Q=z("outline","file-type-csv","FileTypeCsv",K);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M5 18h1.5a1.5 1.5 0 0 0 0 -3h-1.5v6",key:"svg-2"}],["path",{d:"M17 18h2",key:"svg-3"}],["path",{d:"M20 15h-3v6",key:"svg-4"}],["path",{d:"M11 15v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1z",key:"svg-5"}]],Y=z("outline","file-type-pdf","FileTypePdf",W);function ne({filters:g={},onFiltersChange:n,onApplyFilters:m,filterOptions:d={},isLoading:x=!1,className:S=""}){var E,k,M,I,r,a,c,p,f,N,_,F,R;const[t,v]=i.useState({date_range:{start:"",end:""},branch:"",currency:"",demographic:"",product_type:"",...g}),[o,C]=i.useState(!1),[y,$]=i.useState(!1);i.useEffect(()=>{v(s=>({...s,...g}))},[g]),i.useEffect(()=>{const s=Object.entries(t).some(([b,l])=>b==="date_range"?l.start||l.end:l&&l!=="");$(s)},[t]);const h=(s,b)=>{const l={...t,[s]:b};v(l),n==null||n(l)},w=(s,b)=>{const l={...t.date_range,[s]:b};h("date_range",l)},j=()=>{m==null||m(t)},u=()=>{const s={date_range:{start:"",end:""},branch:"",currency:"",demographic:"",product_type:""};v(s),n==null||n(s),m==null||m(s)},D=()=>{let s=0;return Object.entries(t).forEach(([b,l])=>{b==="date_range"?(l.start||l.end)&&s++:l&&l!==""&&s++}),s};return e.jsxs("div",{className:`dashboard-filters ${S}`,children:[e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsxs("button",{type:"button",className:`btn btn-outline-primary ${o?"active":""}`,onClick:()=>C(!o),children:[e.jsx(T,{size:16,className:"me-1"}),"Filters",y&&e.jsx("span",{className:"badge bg-primary ms-2",children:D()})]}),y&&e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:u,title:"Clear all filters",children:e.jsx(P,{size:14})}),e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:j,disabled:x,children:[x?e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}):e.jsx(L,{size:16,className:"me-1"}),"Apply Filters"]})]}),o&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:[e.jsx(q,{size:16,className:"me-1"}),"Date Range"]}),e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col",children:e.jsx("input",{type:"date",className:"form-control",placeholder:"Start date",value:((E=t.date_range)==null?void 0:E.start)||"",max:(k=d.date_range)==null?void 0:k.max,min:(M=d.date_range)==null?void 0:M.min,onChange:s=>w("start",s.target.value)})}),e.jsx("div",{className:"col",children:e.jsx("input",{type:"date",className:"form-control",placeholder:"End date",value:((I=t.date_range)==null?void 0:I.end)||"",max:(r=d.date_range)==null?void 0:r.max,min:((a=t.date_range)==null?void 0:a.start)||((c=d.date_range)==null?void 0:c.min),onChange:s=>w("end",s.target.value)})})]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx(O,{size:16,className:"me-1"}),"Branch"]}),e.jsxs("select",{className:"form-select",value:t.branch||"",onChange:s=>h("branch",s.target.value),children:[e.jsx("option",{value:"",children:"All Branches"}),(p=d.branches)==null?void 0:p.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx(G,{size:16,className:"me-1"}),"Currency"]}),e.jsxs("select",{className:"form-select",value:t.currency||"",onChange:s=>h("currency",s.target.value),children:[e.jsx("option",{value:"",children:"All Currencies"}),(f=d.currencies)==null?void 0:f.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:[e.jsx(U,{size:16,className:"me-1"}),"Customer Segment"]}),e.jsxs("select",{className:"form-select",value:t.demographic||"",onChange:s=>h("demographic",s.target.value),children:[e.jsx("option",{value:"",children:"All Segments"}),(N=d.demographics)==null?void 0:N.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:[e.jsx(X,{size:16,className:"me-1"}),"Product Type"]}),e.jsxs("select",{className:"form-select",value:t.product_type||"",onChange:s=>h("product_type",s.target.value),children:[e.jsx("option",{value:"",children:"All Product Types"}),(_=d.product_types)==null?void 0:_.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),y&&e.jsx("div",{className:"mt-3 pt-3 border-top",children:e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx("small",{className:"text-muted me-2",children:"Active filters:"}),((F=t.date_range)==null?void 0:F.start)&&e.jsxs("span",{className:"badge bg-light text-dark",children:["From: ",t.date_range.start]}),((R=t.date_range)==null?void 0:R.end)&&e.jsxs("span",{className:"badge bg-light text-dark",children:["To: ",t.date_range.end]}),t.branch&&e.jsxs("span",{className:"badge bg-light text-dark",children:["Branch: ",t.branch]}),t.currency&&e.jsxs("span",{className:"badge bg-light text-dark",children:["Currency: ",t.currency]}),t.demographic&&e.jsxs("span",{className:"badge bg-light text-dark",children:["Segment: ",t.demographic]}),t.product_type&&e.jsxs("span",{className:"badge bg-light text-dark",children:["Product: ",t.product_type]})]})})]})})]})}function de({isOpen:g,onClose:n,dashboardId:m,dashboardName:d,currentFilters:x={},className:S=""}){const[t,v]=i.useState("pdf"),[o,C]=i.useState(!1),[y,$]=i.useState({}),[h,w]=i.useState(!0),[j,u]=i.useState(null);i.useEffect(()=>{g&&(D(),u(null))},[g]);const D=async()=>{var r;try{const a=await fetch("/api/dashboards/export/formats",{headers:{Authorization:`Bearer ${(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content")}`,Accept:"application/json"}});if(a.ok){const c=await a.json();$(c.data||{})}}catch(a){console.error("Failed to fetch export formats:",a)}},E=async()=>{var r;if(!(!m||!t)){C(!0),u(null);try{const a=new URLSearchParams;h&&x&&a.append("filters",JSON.stringify(x));const c=`/api/dashboards/${m}/export/${t}?${a.toString()}`,p=document.createElement("a");p.href=c,p.download=`${d}_export.${t}`;const f=await fetch(c,{method:"GET",headers:{Authorization:`Bearer ${(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content")}`,Accept:t==="pdf"?"application/pdf":"text/csv"}});if(f.ok){const N=await f.blob(),_=window.URL.createObjectURL(N);p.href=_,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(_),u({type:"success",message:`Dashboard exported successfully as ${t.toUpperCase()}`}),setTimeout(()=>{n()},2e3)}else{const N=await f.json();throw new Error(N.message||"Export failed")}}catch(a){console.error("Export failed:",a),u({type:"error",message:a.message||"Failed to export dashboard"})}finally{C(!1)}}},k=()=>Object.entries(x||{}).some(([r,a])=>r==="date_range"?(a==null?void 0:a.start)||(a==null?void 0:a.end):a&&a!==""),M=()=>{let r=0;return Object.entries(x||{}).forEach(([a,c])=>{a==="date_range"?(c!=null&&c.start||c!=null&&c.end)&&r++:c&&c!==""&&r++}),r};if(!g)return null;const I=r=>{r.target===r.currentTarget&&!o&&n()};return e.jsx("div",{className:`modal modal-blur fade show ${S}`,style:{display:"block",zIndex:1050},onClick:I,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx(A,{size:20,className:"me-2"}),"Export Dashboard"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:n,disabled:o,"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"mb-2",children:["Dashboard: ",d]}),e.jsx("p",{className:"text-muted small mb-0",children:"Choose your preferred export format and options below."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Export Format"}),e.jsx("div",{className:"row g-2",children:Object.entries(y).map(([r,a])=>e.jsx("div",{className:"col-6",children:e.jsxs("label",{className:"form-selectgroup-item",children:[e.jsx("input",{type:"radio",name:"export-format",value:r,className:"form-selectgroup-input",checked:t===r,onChange:c=>v(c.target.value),disabled:o}),e.jsxs("span",{className:"form-selectgroup-label d-flex align-items-center p-3",children:[r==="pdf"?e.jsx(Y,{size:24,className:"me-2 text-danger"}):e.jsx(Q,{size:24,className:"me-2 text-success"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:a.name}),e.jsx("div",{className:"text-muted small",children:a.description})]})]})]})},r))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Filter Options"}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"include-filters",checked:h,onChange:r=>w(r.target.checked),disabled:o}),e.jsxs("label",{className:"form-check-label",htmlFor:"include-filters",children:["Apply current filters to export",k()&&e.jsxs("span",{className:"badge bg-primary ms-2",children:[M()," active"]})]})]}),h&&k()&&e.jsxs("div",{className:"mt-2 p-2 bg-light rounded",children:[e.jsx("small",{className:"text-muted",children:"Active filters will be applied:"}),e.jsx("div",{className:"d-flex flex-wrap gap-1 mt-1",children:Object.entries(x).map(([r,a])=>r==="date_range"&&(a!=null&&a.start||a!=null&&a.end)?e.jsxs("span",{className:"badge bg-secondary",children:["Date: ",a.start||"Start"," - ",a.end||"End"]},r):a&&a!==""&&r!=="date_range"?e.jsxs("span",{className:"badge bg-secondary",children:[r.replace("_"," "),": ",a]},r):null)})]})]}),j&&e.jsxs("div",{className:`alert ${j.type==="success"?"alert-success":"alert-danger"} d-flex align-items-center`,children:[j.type==="success"?e.jsx(B,{size:20,className:"me-2"}):e.jsx(H,{size:20,className:"me-2"}),j.message]}),t==="pdf"&&e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"PDF Export:"})," Charts will be displayed as static images with data tables. Interactive features will not be available in the PDF."]}),t==="csv"&&e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"CSV Export:"})," Raw data from all widgets will be exported in separate sheets. Chart visualizations will be converted to tabular data."]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:n,disabled:o,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:E,disabled:o||!t,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{size:16,className:"me-1"}),"Export ",t==null?void 0:t.toUpperCase()]})})]})]})})})}export{ne as D,de as E};
