import{r as t,d,j as s}from"./app-BkeQkwCz.js";import{h as q,A as P,l as p,m as M,e as T,b as D}from"./AppLayout-QgBVyLMh.js";import{I as y}from"./IconRefresh-U6chIQJB.js";import{I as Q}from"./IconClock-98JF1g_z.js";import{I as E}from"./IconCircleCheck-72xOlUga.js";import{I as H}from"./IconTrash-DY-55J-g.js";import{I as U}from"./IconPlayerPlay-QXgf9gYp.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M3 12h4l3 8l4 -16l3 8h4",key:"svg-0"}]],j=q("outline","activity","Activity",$);function X({stats:g,health:f,performance:w}){var u,v,b;const[c,_]=t.useState(g||{}),[i,k]=t.useState(f||{status:"healthy",issues:[],recommendations:[]}),[x,C]=t.useState(w||{}),[N,I]=t.useState([]),[a,r]=t.useState(!1),[o,J]=t.useState(!0);t.useEffect(()=>{if(!o)return;const e=setInterval(()=>{n()},3e4);return()=>clearInterval(e)},[o]),t.useEffect(()=>{m()},[]);const n=async()=>{try{const[e,l,S]=await Promise.all([d.get("/api/queue/stats"),d.get("/api/queue/health"),d.get("/api/queue/performance")]);_(e.data.data),k(l.data.data),C(S.data.data)}catch(e){console.error("Failed to refresh queue data:",e)}},m=async()=>{try{const e=await d.get("/api/queue/failed-jobs");I(e.data.data)}catch(e){console.error("Failed to load failed jobs:",e)}},R=async e=>{r(!0);try{await d.post("/api/queue/retry-job",{job_id:e}),await m(),await n()}catch(l){console.error("Failed to retry job:",l)}finally{r(!1)}},z=async()=>{r(!0);try{await d.post("/api/queue/retry-all"),await m(),await n()}catch(e){console.error("Failed to retry all jobs:",e)}finally{r(!1)}},F=async()=>{r(!0);try{await d.post("/api/queue/clear-failed"),await m(),await n()}catch(e){console.error("Failed to clear failed jobs:",e)}finally{r(!1)}},h=async e=>{r(!0);try{await d.post("/api/queue/test-job",{job_type:e}),setTimeout(()=>n(),2e3)}catch(l){console.error("Failed to dispatch test job:",l)}finally{r(!1)}},A=e=>{switch(e){case"healthy":return"bg-success";case"warning":return"bg-warning";case"critical":return"bg-danger";default:return"bg-secondary"}};return s.jsxs(P,{title:"Queue Monitor",children:[s.jsx("div",{className:"page-header d-print-none",children:s.jsx("div",{className:"container-xl",children:s.jsxs("div",{className:"row g-2 align-items-center",children:[s.jsxs("div",{className:"col",children:[s.jsx("div",{className:"page-pretitle",children:"System Monitoring"}),s.jsx("h2",{className:"page-title",children:"Queue Monitor"})]}),s.jsx("div",{className:"col-auto ms-auto d-print-none",children:s.jsxs("div",{className:"btn-list",children:[s.jsxs("button",{className:`btn ${o?"btn-primary":"btn-outline-primary"}`,onClick:()=>J(!o),children:[s.jsx(j,{size:16,className:"me-1"}),"Auto Refresh ",o?"On":"Off"]}),s.jsxs("button",{className:"btn btn-primary",onClick:n,disabled:a,children:[s.jsx(y,{size:16,className:`me-1 ${a?"spin":""}`}),"Refresh"]})]})})]})})}),s.jsx("div",{className:"page-body",children:s.jsx("div",{className:"container-xl",children:s.jsxs("div",{className:"row row-deck row-cards",children:[i.status!=="healthy"&&s.jsx("div",{className:"col-12",children:s.jsx("div",{className:`alert alert-${i.status==="critical"?"danger":"warning"} alert-dismissible`,children:s.jsxs("div",{className:"d-flex",children:[s.jsx("div",{children:s.jsx(p,{size:24})}),s.jsxs("div",{children:[s.jsxs("h4",{children:["Queue Health: ",i.status.toUpperCase()]}),s.jsx("ul",{className:"mb-0",children:i.issues.map((e,l)=>s.jsx("li",{children:e},l))}),i.recommendations.length>0&&s.jsxs("div",{className:"mt-2",children:[s.jsx("strong",{children:"Recommendations:"}),s.jsx("ul",{children:i.recommendations.map((e,l)=>s.jsx("li",{children:e},l))})]})]})]})})}),s.jsx("div",{className:"col-sm-6 col-lg-3",children:s.jsx("div",{className:"card",children:s.jsxs("div",{className:"card-body",children:[s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("div",{className:"subheader",children:"Pending Jobs"}),s.jsx("div",{className:"ms-auto",children:s.jsx("div",{className:"bg-primary text-white avatar",children:s.jsx(Q,{size:24})})})]}),s.jsx("div",{className:"h1 mb-3",children:c.pending_jobs||0}),s.jsx("div",{className:"text-muted",children:"Jobs waiting to be processed"})]})})}),s.jsx("div",{className:"col-sm-6 col-lg-3",children:s.jsx("div",{className:"card",children:s.jsxs("div",{className:"card-body",children:[s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("div",{className:"subheader",children:"Failed Jobs"}),s.jsx("div",{className:"ms-auto",children:s.jsx("div",{className:"bg-danger text-white avatar",children:s.jsx(p,{size:24})})})]}),s.jsx("div",{className:"h1 mb-3 text-danger",children:c.failed_jobs||0}),s.jsx("div",{className:"text-muted",children:"Jobs that failed processing"})]})})}),s.jsx("div",{className:"col-sm-6 col-lg-3",children:s.jsx("div",{className:"card",children:s.jsxs("div",{className:"card-body",children:[s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("div",{className:"subheader",children:"Processed Today"}),s.jsx("div",{className:"ms-auto",children:s.jsx("div",{className:"bg-success text-white avatar",children:s.jsx(E,{size:24})})})]}),s.jsx("div",{className:"h1 mb-3 text-success",children:c.processed_jobs_today||0}),s.jsx("div",{className:"text-muted",children:"Jobs completed today"})]})})}),s.jsx("div",{className:"col-sm-6 col-lg-3",children:s.jsx("div",{className:"card",children:s.jsxs("div",{className:"card-body",children:[s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("div",{className:"subheader",children:"Health Status"}),s.jsx("div",{className:"ms-auto",children:s.jsx("div",{className:"bg-info text-white avatar",children:s.jsx(j,{size:24})})})]}),s.jsx("div",{className:"h1 mb-3",children:s.jsx("span",{className:`badge ${A(i.status)} text-white`,children:i.status.toUpperCase()})}),s.jsx("div",{className:"text-muted",children:"Overall queue health"})]})})}),s.jsx("div",{className:"col-sm-6 col-lg-3",children:s.jsx("div",{className:"card",children:s.jsxs("div",{className:"card-body",children:[s.jsx("div",{className:"subheader",children:"Jobs/Minute"}),s.jsx("div",{className:"h2 mb-0",children:x.jobs_per_minute||0})]})})}),s.jsx("div",{className:"col-sm-6 col-lg-3",children:s.jsx("div",{className:"card",children:s.jsxs("div",{className:"card-body",children:[s.jsx("div",{className:"subheader",children:"Avg Wait Time"}),s.jsxs("div",{className:"h2 mb-0",children:[x.average_wait_time||0,"s"]})]})})}),s.jsx("div",{className:"col-sm-6 col-lg-3",children:s.jsx("div",{className:"card",children:s.jsxs("div",{className:"card-body",children:[s.jsx("div",{className:"subheader",children:"Success Rate"}),s.jsxs("div",{className:"h2 mb-0 text-success",children:[x.success_rate||0,"%"]})]})})}),s.jsx("div",{className:"col-sm-6 col-lg-3",children:s.jsx("div",{className:"card",children:s.jsxs("div",{className:"card-body",children:[s.jsx("div",{className:"subheader",children:"Worker Status"}),s.jsxs("div",{className:"h2 mb-0",children:[((u=c.worker_status)==null?void 0:u.active_workers)||0,"/",((v=c.worker_status)==null?void 0:v.total_workers)||0]}),s.jsx("div",{className:"text-muted",children:((b=c.worker_status)==null?void 0:b.status)||"Unknown"})]})})}),s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header",children:s.jsx("h3",{className:"card-title",children:"Queue Actions"})}),s.jsx("div",{className:"card-body",children:s.jsxs("div",{className:"row g-2",children:[s.jsx("div",{className:"col-12",children:s.jsxs("button",{className:"btn btn-primary w-100",onClick:z,disabled:a||c.failed_jobs===0,children:[s.jsx(y,{size:16,className:"me-1"}),"Retry All Failed Jobs"]})}),s.jsx("div",{className:"col-12",children:s.jsxs("button",{className:"btn btn-danger w-100",onClick:F,disabled:a||c.failed_jobs===0,children:[s.jsx(H,{size:16,className:"me-1"}),"Clear All Failed Jobs"]})})]})})]})}),s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header",children:s.jsx("h3",{className:"card-title",children:"Test Jobs"})}),s.jsx("div",{className:"card-body",children:s.jsxs("div",{className:"row g-2",children:[s.jsx("div",{className:"col-6",children:s.jsxs("button",{className:"btn btn-outline-primary w-100",onClick:()=>h("profitability"),disabled:a,children:[s.jsx(M,{size:16,className:"me-1"}),"Profitability"]})}),s.jsx("div",{className:"col-6",children:s.jsxs("button",{className:"btn btn-outline-primary w-100",onClick:()=>h("dashboard"),disabled:a,children:[s.jsx(j,{size:16,className:"me-1"}),"Dashboard"]})}),s.jsx("div",{className:"col-6",children:s.jsxs("button",{className:"btn btn-outline-primary w-100",onClick:()=>h("notification"),disabled:a,children:[s.jsx(T,{size:16,className:"me-1"}),"Notification"]})}),s.jsx("div",{className:"col-6",children:s.jsxs("button",{className:"btn btn-outline-primary w-100",onClick:()=>h("dataset"),disabled:a,children:[s.jsx(D,{size:16,className:"me-1"}),"Dataset"]})})]})})]})}),N.length>0&&s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header",children:s.jsx("h3",{className:"card-title",children:"Recent Failed Jobs"})}),s.jsx("div",{className:"card-body",children:s.jsx("div",{className:"divide-y",children:N.map(e=>s.jsxs("div",{className:"row py-3",children:[s.jsxs("div",{className:"col",children:[s.jsx("div",{className:"strong",children:e.queue}),s.jsxs("div",{className:"text-muted",children:["Failed at: ",new Date(e.failed_at).toLocaleString()]}),s.jsx("div",{className:"text-danger small mt-1",children:e.exception.split(`
`)[0]})]}),s.jsx("div",{className:"col-auto",children:s.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>R(e.id),disabled:a,children:[s.jsx(U,{size:16,className:"me-1"}),"Retry"]})})]},e.id))})})]})})]})})})]})}export{X as default};
