import{r as t,j as s,L as b,v as D,b as S,a as C}from"./app-BkeQkwCz.js";import{u as k,A as E}from"./AppLayout-QgBVyLMh.js";import{D as w}from"./DashboardBuilder-Qw8Rt6AF.js";import{I as A}from"./IconArrowLeft-0rt3x0IP.js";import{I as F}from"./IconDeviceFloppy-BoO_tT2I.js";import"./HeatmapWidget-BYek--Va.js";import"./useCurrency-IKboy93q.js";import"./IconTrendingDown--I_y3ylQ.js";import"./IconTrendingUp-CoTcLOBw.js";import"./IconSearch-qzSKrpRq.js";import"./IconChevronUp-CSfYcfYK.js";import"./PieChart-DdrwvuuX.js";import"./IconTrash-DY-55J-g.js";import"./IconChartPie-jWzm51Em.js";import"./IconPlus-Cs3MX6an.js";function Q({formulas:u,products:x,customers:j,widgetTypes:p}){const[n,c]=t.useState({name:"",layout:[],filters:{}}),[o,f]=t.useState([]),[m,l]=t.useState(!1),[d,h]=t.useState({}),{showSuccess:v,showError:r}=k(),N=a=>{if(a.preventDefault(),!D()){console.error("CSRF token not available for dashboard submission"),r("CSRF token not available. Please refresh the page.");return}console.log("Submitting dashboard data:",n),console.log("Widgets data:",o);const i={...n,layout:o,widgets:o,_token:S()};console.log("Complete form data being sent:",i),l(!0),h({}),C.post("/dashboards",i,{onStart:()=>{console.log("Dashboard form submission started...")},onProgress:()=>{console.log("Dashboard form submission in progress...")},onSuccess:e=>{console.log("Dashboard form submission successful:",e),v("Dashboard created successfully!"),l(!1)},onError:e=>{if(console.error("Dashboard form submission error:",e),console.error("Error type:",typeof e),console.error("Error details:",JSON.stringify(e,null,2)),h(e),l(!1),typeof e=="object"&&e!==null)if(Array.isArray(e))r(e.join(", "),"Validation Error");else{const y=Object.values(e).flat();r(y.join(", "),"Validation Error")}else r(typeof e=="string"?e:"Failed to create dashboard. Please try again.")},onFinish:()=>{console.log("Dashboard form submission finished"),l(!1)}})},g=a=>{f(a)};return s.jsxs(E,{title:"Create Dashboard",children:[s.jsx("div",{className:"page-header d-print-none",children:s.jsx("div",{className:"container-xl",children:s.jsxs("div",{className:"row g-2 align-items-center",children:[s.jsxs("div",{className:"col",children:[s.jsx("nav",{"aria-label":"breadcrumb",children:s.jsxs("ol",{className:"breadcrumb",children:[s.jsx("li",{className:"breadcrumb-item",children:s.jsx(b,{href:"/dashboards",children:"Dashboards"})}),s.jsx("li",{className:"breadcrumb-item active","aria-current":"page",children:"Create"})]})}),s.jsx("div",{className:"page-pretitle",children:"Analytics"}),s.jsx("h2",{className:"page-title",children:"Create Dashboard"})]}),s.jsx("div",{className:"col-auto ms-auto d-print-none",children:s.jsxs("div",{className:"btn-list",children:[s.jsxs(b,{href:"/dashboards",className:"btn",children:[s.jsx(A,{size:16,className:"me-1"}),"Back to Dashboards"]}),s.jsxs("button",{type:"submit",form:"dashboard-form",className:"btn btn-primary",disabled:m,children:[s.jsx(F,{size:16,className:"me-1"}),m?"Saving...":"Save Dashboard"]})]})})]})})}),s.jsx("div",{className:"page-body",children:s.jsx("div",{className:"container-fluid px-3",children:s.jsxs("div",{className:"row g-3",children:[s.jsx("div",{className:"col-12",children:s.jsx("form",{id:"dashboard-form",onSubmit:N,children:s.jsxs("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header",children:s.jsx("h3",{className:"card-title",children:"Dashboard Settings"})}),s.jsx("div",{className:"card-body",children:s.jsxs("div",{className:"row g-3",children:[s.jsx("div",{className:"col-lg-8 col-xl-6",children:s.jsxs("div",{className:"mb-0",children:[s.jsx("label",{className:"form-label required",children:"Dashboard Name"}),s.jsx("input",{type:"text",className:`form-control form-control-lg ${d.name?"is-invalid":""}`,value:n.name,onChange:a=>c(i=>({...i,name:a.target.value})),placeholder:"Enter dashboard name",required:!0}),d.name&&s.jsx("div",{className:"invalid-feedback",children:d.name}),s.jsx("div",{className:"form-text",children:"Choose a descriptive name for your dashboard that reflects its purpose and content."})]})}),s.jsx("div",{className:"col-lg-4 col-xl-6",children:s.jsxs("div",{className:"mb-0",children:[s.jsx("label",{className:"form-label",children:"Quick Actions"}),s.jsxs("div",{className:"d-flex flex-column gap-2",children:[s.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>c(a=>({...a,name:"Analytics Dashboard"})),children:"Use Analytics Template"}),s.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>c(a=>({...a,name:"Portfolio Overview"})),children:"Use Portfolio Template"})]})]})})]})})]})})}),s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header",children:s.jsxs("div",{className:"row align-items-center",children:[s.jsxs("div",{className:"col",children:[s.jsx("h3",{className:"card-title mb-0",children:"Dashboard Layout"}),s.jsx("div",{className:"text-muted small",children:"Drag and drop widgets to build your dashboard"})]}),s.jsx("div",{className:"col-auto",children:s.jsx("div",{className:"btn-list",children:s.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm",children:"Reset Layout"})})})]})}),s.jsx("div",{className:"card-body p-0",children:s.jsx("div",{className:"min-vh-50",children:s.jsx(w,{widgets:o,onWidgetsChange:g,isEditing:!0,formulas:u,products:x,customers:j,widgetTypes:p})})})]})})]})})})]})}export{Q as default};
