import{r as n,j as e,L as o,_ as w}from"./app-BkeQkwCz.js";import{A as _,c as T,m as N}from"./AppLayout-QgBVyLMh.js";import{I as C}from"./IconArrowLeft-0rt3x0IP.js";import{I as E}from"./IconCopy-EHB0SucX.js";import{I as S}from"./IconDownload-DpSVhOrW.js";import{I as D}from"./IconCode-DLTX4WmA.js";import{I as v}from"./IconPlayerPlay-QXgf9gYp.js";function U({formula:s,usageStats:d}){const[r,m]=n.useState(null),[j,p]=n.useState("{}"),[u,x]=n.useState(!1),h=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),b=a=>({numeric:"bg-blue-500",text:"bg-green",boolean:"bg-blue-600",date:"bg-orange-500"})[a]||"bg-secondary";n.useEffect(()=>{const a=c=>{const t=document.getElementById("custom-data-section");c.target.value==="custom"?t.style.display="block":t.style.display="none"},l=document.querySelectorAll('input[name="test-data-source"]');return l.forEach(c=>{c.addEventListener("change",a)}),()=>{l.forEach(c=>{c.removeEventListener("change",a)})}},[]);const f=async()=>{x(!0);try{const a=document.querySelector('input[name="test-data-source"]:checked').value;let l={expression:s.expression,product_id:s.product_id,use_real_data:a==="real"};if(a==="custom")try{l.sample_data=JSON.parse(j)}catch{m({success:!1,message:"Invalid JSON format in custom data"}),x(!1);return}const{default:c}=await w(async()=>{const{default:i}=await import("./apiClient-B5VLjQ69.js");return{default:i}},[]),t=await c.post("/formulas/test",l);m(t.data)}catch(a){m({success:!1,message:"Test failed: "+a.message})}finally{x(!1)}},y=async()=>{try{const a=await fetch(`/api/formulas/${s.id}/duplicate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({name:`${s.name} (Copy)`,description:`Copy of ${s.name}`})});if(a.ok){const l=await a.json();window.location.href=`/formulas/${l.formula.id}`}}catch(a){console.error("Failed to duplicate formula:",a)}},g=async()=>{try{const l=await(await fetch(`/api/formulas/${s.id}/export`)).json();if(l.success){const c=new Blob([JSON.stringify(l.data,null,2)],{type:"application/json"}),t=URL.createObjectURL(c),i=document.createElement("a");i.href=t,i.download=`formula-${s.name.toLowerCase().replace(/\s+/g,"-")}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}}catch(a){console.error("Failed to export formula:",a)}};return e.jsxs(_,{title:`Formula: ${s.name}`,children:[e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"row g-2 align-items-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("nav",{"aria-label":"breadcrumb",children:e.jsxs("ol",{className:"breadcrumb",children:[e.jsx("li",{className:"breadcrumb-item",children:e.jsx(o,{href:"/formulas",children:"Formulas"})}),e.jsx("li",{className:"breadcrumb-item active","aria-current":"page",children:s.name})]})}),e.jsx("div",{className:"page-pretitle",children:"Formula Details"}),e.jsx("h2",{className:"page-title",children:s.name})]}),e.jsx("div",{className:"col-auto ms-auto d-print-none",children:e.jsxs("div",{className:"btn-list",children:[e.jsxs(o,{href:"/formulas",className:"btn",children:[e.jsx(C,{size:16,className:"me-1"}),"Back to Formulas"]}),e.jsxs("button",{className:"btn",onClick:y,children:[e.jsx(E,{size:16,className:"me-1"}),"Duplicate"]}),e.jsxs("button",{className:"btn",onClick:g,children:[e.jsx(S,{size:16,className:"me-1"}),"Export"]}),e.jsxs(o,{href:`/formulas/${s.id}/edit`,className:"btn btn-primary",children:[e.jsx(T,{size:16,className:"me-1"}),"Edit Formula"]})]})})]})})}),e.jsx("div",{className:"page-body",children:e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"row row-deck row-cards",children:[e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(D,{size:18,className:"me-2"}),"Formula Details"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Name"}),e.jsx("div",{className:"form-control-plaintext",children:s.name})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("div",{className:"form-control-plaintext",children:s.description||"No description provided"})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Expression"}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("pre",{className:"mb-0",children:e.jsx("code",{children:s.expression})})})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Return Type"}),e.jsx("div",{children:e.jsx("span",{className:`badge ${b(s.return_type)} text-white`,children:s.return_type})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsx("div",{children:e.jsx("span",{className:`badge ${s.is_active?"bg-success":"bg-secondary"} text-white`,children:s.is_active?"Active":"Inactive"})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Product"}),e.jsx("div",{className:"form-control-plaintext",children:s.product?e.jsx(o,{href:`/products/${s.product.id}`,className:"text-decoration-none",children:s.product.name}):e.jsx("span",{className:"text-muted",children:"Global Formula"})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Created By"}),e.jsx("div",{className:"form-control-plaintext",children:s.creator?s.creator.name:"Unknown"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Created"}),e.jsx("div",{className:"form-control-plaintext",children:h(s.created_at)})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Updated"}),e.jsx("div",{className:"form-control-plaintext",children:h(s.updated_at)})]})})]})})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(N,{size:18,className:"me-2"}),"Usage Statistics"]})}),e.jsx("div",{className:"card-body",children:d?e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("div",{className:"subheader",children:"Total Executions"}),e.jsx("div",{className:"ms-auto",children:e.jsx("div",{className:"h3 mb-0",children:d.total_executions||0})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("div",{className:"subheader",children:"Success Rate"}),e.jsx("div",{className:"ms-auto",children:e.jsxs("div",{className:"h3 mb-0",children:[d.success_rate||0,"%"]})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("div",{className:"subheader",children:"Avg Execution Time"}),e.jsx("div",{className:"ms-auto",children:e.jsxs("div",{className:"h3 mb-0",children:[d.avg_execution_time||0,"ms"]})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"subheader",children:"Last Used"}),e.jsx("div",{className:"ms-auto",children:e.jsx("div",{className:"text-muted",children:d.last_used?h(d.last_used):"Never"})})]})})]}):e.jsxs("div",{className:"empty",children:[e.jsx("div",{className:"empty-img",children:e.jsx(N,{size:48,className:"text-muted"})}),e.jsx("p",{className:"empty-title",children:"No usage data"}),e.jsx("p",{className:"empty-subtitle text-muted",children:"This formula hasn't been used yet."})]})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title",children:[e.jsx(v,{size:18,className:"me-2"}),"Test Formula"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Test Data Source"}),e.jsxs("div",{className:"form-selectgroup form-selectgroup-boxes d-flex flex-column",children:[e.jsxs("label",{className:"form-selectgroup-item flex-fill",children:[e.jsx("input",{type:"radio",name:"test-data-source",value:"real",className:"form-selectgroup-input",defaultChecked:!0}),e.jsxs("div",{className:"form-selectgroup-label",children:[e.jsx("div",{className:"fw-bold",children:"Use Real Database Data"}),e.jsx("div",{className:"text-muted",children:"Test formula with actual product data from database"})]})]}),e.jsxs("label",{className:"form-selectgroup-item flex-fill",children:[e.jsx("input",{type:"radio",name:"test-data-source",value:"custom",className:"form-selectgroup-input"}),e.jsxs("div",{className:"form-selectgroup-label",children:[e.jsx("div",{className:"fw-bold",children:"Custom Sample Data"}),e.jsx("div",{className:"text-muted",children:"Provide your own test data"})]})]})]}),e.jsxs("div",{id:"custom-data-section",style:{display:"none"},children:[e.jsx("textarea",{className:"form-control mt-3",rows:"6",value:j,onChange:a=>p(a.target.value),placeholder:'{"field1": 100, "field2": 200}'}),e.jsx("div",{className:"form-hint",children:"Provide sample data in JSON format to test the formula"})]})]}),e.jsxs("button",{className:"btn btn-primary",onClick:f,disabled:u,children:[e.jsx(v,{size:16,className:"me-1"}),u?"Testing...":"Test Formula"]})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Test Result"}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:r?e.jsx("div",{children:r.success?e.jsxs("div",{children:[e.jsx("div",{className:"text-success mb-2",children:"✓ Test Successful"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Result:"})," ",JSON.stringify(r.result)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",r.result_type]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Execution Time:"})," ",r.execution_time,"ms"]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"text-danger mb-2",children:"✗ Test Failed"}),e.jsx("div",{children:r.message})]})}):e.jsx("div",{className:"text-muted",children:'Click "Test Formula" to see results here'})})})]})})]})})]})})]})})})]})}export{U as default};
