import{u as j,r as N,j as e,H as g}from"./app-BkeQkwCz.js";import{A as f}from"./AppLayout-QgBVyLMh.js";import{D as _}from"./DashboardBuilder-Qw8Rt6AF.js";import{u as y}from"./useFormWithCsrf-CQ_fNGy5.js";import{I as D}from"./IconArrowLeft-0rt3x0IP.js";import{I as w}from"./IconDeviceFloppy-BoO_tT2I.js";import"./HeatmapWidget-BYek--Va.js";import"./useCurrency-IKboy93q.js";import"./IconTrendingDown--I_y3ylQ.js";import"./IconTrendingUp-CoTcLOBw.js";import"./IconSearch-qzSKrpRq.js";import"./IconChevronUp-CSfYcfYK.js";import"./PieChart-DdrwvuuX.js";import"./IconTrash-DY-55J-g.js";import"./IconChartPie-jWzm51Em.js";import"./IconPlus-Cs3MX6an.js";function R(){const{dashboard:a,formulas:m=[],products:t=[],customers:h=[]}=j().props,{data:i,setData:l,put:p,processing:o,errors:d}=y({name:a.name,layout:a.layout||[],filters:a.filters||{},widgets:a.widgets||[],product_id:a.product_id||null,description:a.description||"",is_public:a.is_public||!1,is_active:a.is_active!==!1}),[c,u]=N.useState(a.widgets||[]),x=s=>{s.preventDefault();const n={name:i.name,description:i.description,product_id:i.product_id,is_public:i.is_public,is_active:i.is_active,layout:c,widgets:c,filters:i.filters};if(console.log("Submitting dashboard data:",n),console.log("Widgets array:",c),console.log("Widgets count:",c.length),c.length===0){alert("Please add at least one widget before saving the dashboard.");return}p(`/dashboards/${a.id}`,{data:n,onSuccess:r=>{console.log("Dashboard updated successfully:",r),alert("Dashboard updated successfully!"),window.location.href=`/dashboards/${a.id}`},onError:r=>{console.error("Dashboard update errors:",r);const v=Object.values(r).flat().join(", ");alert("Error updating dashboard: "+v)},onFinish:()=>{console.log("Request finished")}})},b=s=>{console.log("Widgets changed:",s),console.log("New widgets count:",s.length),u(s)};return e.jsxs(f,{children:[e.jsx(g,{title:`Edit Dashboard - ${a.name}`}),e.jsxs("div",{className:"page-wrapper",children:[e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"row g-2 align-items-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"page-pretitle",children:e.jsxs("a",{href:`/dashboards/${a.id}`,className:"text-muted",children:[e.jsx(D,{size:16,className:"me-1"}),"Back to Dashboard"]})}),e.jsx("h2",{className:"page-title",children:"Edit Dashboard"})]}),e.jsx("div",{className:"col-auto ms-auto d-print-none",children:e.jsxs("button",{type:"button",className:"btn btn-primary",disabled:o,onClick:x,children:[e.jsx(w,{size:16,className:"me-1"}),o?"Saving...":"Save Changes"]})})]})})}),e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"container-xl",children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Dashboard Settings"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label required",children:"Dashboard Name"}),e.jsx("input",{type:"text",className:`form-control ${d.name?"is-invalid":""}`,value:i.name,onChange:s=>l("name",s.target.value),placeholder:"Enter dashboard name",required:!0}),d.name&&e.jsx("div",{className:"invalid-feedback",children:d.name})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Product"}),e.jsxs("select",{className:`form-select ${d.product_id?"is-invalid":""}`,value:i.product_id||"",onChange:s=>l("product_id",s.target.value||null),children:[e.jsx("option",{value:"",children:"Select a Product (Optional)"}),t.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.category,")"]},s.id))]}),d.product_id&&e.jsx("div",{className:"invalid-feedback",children:d.product_id})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{className:`form-control ${d.description?"is-invalid":""}`,value:i.description,onChange:s=>l("description",s.target.value),placeholder:"Enter dashboard description",rows:"3"}),d.description&&e.jsx("div",{className:"invalid-feedback",children:d.description})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"is_public",checked:i.is_public,onChange:s=>l("is_public",s.target.checked)}),e.jsx("label",{className:"form-check-label",htmlFor:"is_public",children:"Public Dashboard"})]}),e.jsx("div",{className:"form-text text-muted",children:"Allow other users to view this dashboard"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"is_active",checked:i.is_active,onChange:s=>l("is_active",s.target.checked)}),e.jsx("label",{className:"form-check-label",htmlFor:"is_active",children:"Active Dashboard"})]}),e.jsx("div",{className:"form-text text-muted",children:"Enable this dashboard for use"})]})})]})})]})})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:"Dashboard Layout"}),e.jsx("div",{className:"card-actions",children:e.jsx("div",{className:"text-muted small",children:"Drag and drop widgets to customize your dashboard"})})]}),e.jsx("div",{className:"card-body",children:e.jsx(_,{widgets:c,onWidgetsChange:b,isEditing:!0,dashboardId:a.id,formulas:m,products:t,customers:h})})]})]})})]})]})}export{R as default};
