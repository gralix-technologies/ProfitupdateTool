import{r as m,j as e,H as U}from"./app-BkeQkwCz.js";import{u as z,A as O}from"./AppLayout-QgBVyLMh.js";import{u as V}from"./useFormWithCsrf-CQ_fNGy5.js";import{I as h}from"./IconUpload-DI1O2urB.js";import{I as A}from"./IconDownload-DpSVhOrW.js";function B({products:p=[],templates:N=[]}){const{data:i,setData:x,post:f,processing:j,errors:r}=V({product_id:"",csv_file:null,field_mapping:{}}),[g,b]=m.useState(!1),[c,y]=m.useState([]),[_,w]=m.useState({}),{showSuccess:D,showError:t}=z(),S=s=>{const a=s.target.files[0];if(a){x("csv_file",a);const l=new FileReader;l.onload=n=>{const v=n.target.result.split(`
`),F=v[0].split(",").map(o=>o.trim()),M=v.slice(1,6).map(o=>{const P=o.split(",").map(d=>d.trim());return F.reduce((d,E,T)=>(d[E]=P[T]||"",d),{})});y(M),b(!0)},l.readAsText(a)}},C=(s,a)=>{w(l=>({...l,[s]:a}))},I=s=>{if(s.preventDefault(),!i.product_id){t("Please select a product");return}if(!i.csv_file){t("Please select a CSV file");return}f("/data-import",{onSuccess:()=>{D("Data imported successfully!")},onError:a=>{if(typeof a=="object"&&a!==null){const l=Object.values(a).flat();t(l.join(", "),"Import Error")}else t(typeof a=="string"?a:"Failed to import data. Please try again.")}})},u=p.find(s=>s.id.toString()===i.product_id);return e.jsxs(O,{children:[e.jsx(U,{title:"Data Import"}),e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-fluid px-3",children:e.jsx("div",{className:"row g-2 align-items-center",children:e.jsxs("div",{className:"col",children:[e.jsxs("h2",{className:"page-title",children:[e.jsx(h,{size:24,className:"me-2"}),"Data Import"]}),e.jsx("div",{className:"text-muted",children:"Upload your product data to populate dashboards"})]})})})}),e.jsx("div",{className:"page-body",children:e.jsx("div",{className:"container-fluid px-3",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Import Configuration"})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Product"}),e.jsxs("select",{className:"form-control form-control-lg",value:i.product_id,onChange:s=>x("product_id",s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a product..."}),p.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.category,")"]},s.id))]}),r.product_id&&e.jsx("div",{className:"text-danger mt-1",children:r.product_id})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"CSV File"}),e.jsx("input",{type:"file",className:"form-control form-control-lg",accept:".csv",onChange:S,required:!0}),r.csv_file&&e.jsx("div",{className:"text-danger mt-1",children:r.csv_file})]}),g&&u&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Field Mapping"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"CSV Column"}),e.jsx("th",{children:"Product Field"})]})}),e.jsx("tbody",{children:Object.keys(c[0]||{}).map(s=>{var a;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("code",{children:s})}),e.jsx("td",{children:e.jsxs("select",{className:"form-select form-select-sm",value:_[s]||"",onChange:l=>C(s,l.target.value),children:[e.jsx("option",{value:"",children:"Map to field..."}),(a=u.field_definitions)==null?void 0:a.map(l=>e.jsxs("option",{value:l.name,children:[l.name," (",l.type,")"]},l.name))]})})]},s)})})]})})]}),e.jsx("div",{className:"d-grid",children:e.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{size:20,className:"me-2"}),"Import Data"]})})})]})})]})}),e.jsxs("div",{className:"col-lg-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Data Preview"})}),e.jsx("div",{className:"card-body",children:c.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsx("tr",{children:Object.keys(c[0]).map(s=>e.jsx("th",{children:s},s))})}),e.jsx("tbody",{children:c.map((s,a)=>e.jsx("tr",{children:Object.values(s).map((l,n)=>e.jsx("td",{children:l},n))},a))})]})}):e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx(h,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{children:"Upload a CSV file to preview data"})]})})]}),e.jsxs("div",{className:"card mt-3",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Download Templates"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"list-group list-group-flush",children:N.map(s=>e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("h6",{className:"mb-1",children:s.name}),e.jsx("p",{className:"text-muted mb-0",children:s.description})]}),e.jsx("div",{className:"col-auto",children:e.jsxs("a",{href:s.download_url,className:"btn btn-outline-primary btn-sm",children:[e.jsx(A,{size:16,className:"me-1"}),"Download"]})})]})},s.id))})})]})]})]})})})]})}export{B as default};
