import{r,j as s,H as d,L as z}from"./app-BkeQkwCz.js";import{A as m,m as K}from"./AppLayout-QgBVyLMh.js";import{D as B,E as H}from"./ExportModal-CkZ65kld.js";import{I as _,H as q,L as M,P as X,B as J,T as U,K as V}from"./HeatmapWidget-BYek--Va.js";import{I as C}from"./IconRefresh-U6chIQJB.js";import{I as $}from"./IconArrowLeft-0rt3x0IP.js";import{I as G}from"./IconDownload-DpSVhOrW.js";import{I as Q}from"./IconTrendingUp-CoTcLOBw.js";import"./IconFilter-DpaF_UhO.js";import"./IconCalendar-C52FWICz.js";import"./IconCurrencyDollar-DCDJ1xJI.js";import"./IconAlertCircle-WImK9GUn.js";import"./useCurrency-IKboy93q.js";import"./IconTrendingDown--I_y3ylQ.js";import"./IconSearch-qzSKrpRq.js";import"./IconChevronUp-CSfYcfYK.js";import"./PieChart-DdrwvuuX.js";function js(){const[h,D]=r.useState([]),[p,E]=r.useState([]),[x,j]=r.useState({}),[S,A]=r.useState({}),[I,N]=r.useState(!1),[F,f]=r.useState(!1),[T,L]=r.useState({}),[P,u]=r.useState(!0),[b,v]=r.useState(null);r.useEffect(()=>{g(),k()},[]);const g=async()=>{var e,t;try{u(!0);const a=await fetch("/api/dashboards",{headers:{"X-CSRF-TOKEN":(e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"},credentials:"same-origin"});if(a.ok){const c=await a.json();D(c.data||[]);const o=[];(t=c.data)==null||t.forEach(n=>{n.widgets&&n.widgets.forEach(R=>{o.push({...R,dashboard_id:n.id,dashboard_name:n.name})})}),E(o)}else v("Failed to fetch dashboards")}catch(a){v("Error loading dashboards: "+a.message)}finally{u(!1)}},k=async()=>{var e;try{const t=await fetch("/api/dashboards/1/filter-options",{headers:{"X-CSRF-TOKEN":(e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"},credentials:"same-origin"});if(t.ok){const a=await t.json();A(a.data||{})}}catch(t){console.error("Failed to fetch filter options:",t)}},w=e=>{j(e)},W=async e=>{var t;N(!0);try{const a={};for(const c of h){const o=await fetch(`/api/dashboards/${c.id}/filters`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"),Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({filters:e})});if(o.ok){const n=await o.json();Object.assign(a,n.data||{})}}L(a),j(e)}catch(a){console.error("Error applying filters:",a)}finally{N(!1)}},O=()=>{f(!0)},y=()=>{g()},i=e=>{const t=T[e.id],a={widget:e,dashboardId:e.dashboard_id,isEditing:!1,filteredData:t};switch(e.type){case"KPI":return s.jsx(V,{...a},e.id);case"Table":return s.jsx(U,{...a},e.id);case"BarChart":return s.jsx(J,{...a},e.id);case"PieChart":return s.jsx(X,{...a},e.id);case"LineChart":return s.jsx(M,{...a},e.id);case"Heatmap":return s.jsx(q,{...a},e.id);default:return null}},l=e=>p.filter(t=>t.type===e);return P?s.jsxs(m,{children:[s.jsx(d,{title:"Consolidated Dashboard"}),s.jsx("div",{className:"page-wrapper",children:s.jsx("div",{className:"page-body",children:s.jsx("div",{className:"container-xl",children:s.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{minHeight:"400px"},children:s.jsx("div",{className:"spinner-border text-primary",role:"status",children:s.jsx("span",{className:"visually-hidden",children:"Loading..."})})})})})})]}):b?s.jsxs(m,{children:[s.jsx(d,{title:"Consolidated Dashboard"}),s.jsx("div",{className:"page-wrapper",children:s.jsx("div",{className:"page-body",children:s.jsx("div",{className:"container-xl",children:s.jsxs("div",{className:"alert alert-danger",children:[s.jsx("h4",{children:"Error Loading Dashboard"}),s.jsx("p",{children:b}),s.jsxs("button",{className:"btn btn-primary",onClick:y,children:[s.jsx(C,{size:16,className:"me-1"}),"Retry"]})]})})})})]}):s.jsxs(m,{children:[s.jsx(d,{title:"Consolidated Portfolio Analytics Dashboard"}),s.jsxs("div",{className:"page-wrapper",children:[s.jsx("div",{className:"page-header d-print-none",children:s.jsx("div",{className:"container-xl",children:s.jsxs("div",{className:"row g-2 align-items-center",children:[s.jsxs("div",{className:"col",children:[s.jsx("div",{className:"page-pretitle",children:s.jsxs(z,{href:"/dashboards",className:"text-muted",children:[s.jsx($,{size:16,className:"me-1"}),"Back to Dashboards"]})}),s.jsx("h2",{className:"page-title",children:"Consolidated Portfolio Analytics Dashboard"}),s.jsxs("div",{className:"text-muted mt-1",children:[p.length," widgets from ",h.length," dashboards â€¢ Comprehensive portfolio overview"]})]}),s.jsx("div",{className:"col-auto ms-auto d-print-none",children:s.jsxs("div",{className:"btn-list",children:[s.jsxs("button",{type:"button",className:"btn btn-outline-secondary",onClick:y,title:"Refresh Data",children:[s.jsx(C,{size:16,className:"me-1"}),"Refresh"]}),s.jsxs("button",{type:"button",className:"btn btn-outline-primary",onClick:O,children:[s.jsx(G,{size:16,className:"me-1"}),"Export"]})]})})]})})}),s.jsx("div",{className:"page-body",children:s.jsxs("div",{className:"container-xl",children:[s.jsx(B,{filters:x,onFiltersChange:w,onApplyFilters:W,filterOptions:S,isLoading:I,className:"mb-4"}),s.jsx("div",{className:"row mb-4",children:s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header",children:s.jsxs("h3",{className:"card-title",children:[s.jsx(Q,{size:20,className:"me-2"}),"Key Performance Indicators"]})}),s.jsx("div",{className:"card-body",children:s.jsx("div",{className:"row g-3",children:l("KPI").map(e=>s.jsx("div",{className:"col-xl-3 col-lg-4 col-md-6",children:i(e)},e.id))})})]})})}),s.jsx("div",{className:"row mb-4",children:s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"card",children:[s.jsx("div",{className:"card-header",children:s.jsxs("h3",{className:"card-title",children:[s.jsx(K,{size:20,className:"me-2"}),"Portfolio Analytics & Visualizations"]})}),s.jsx("div",{className:"card-body",children:s.jsxs("div",{className:"row g-3",children:[l("BarChart").map(e=>s.jsx("div",{className:"col-xl-6 col-lg-12",children:i(e)},e.id)),l("PieChart").map(e=>s.jsx("div",{className:"col-xl-6 col-lg-12",children:i(e)},e.id)),l("LineChart").map(e=>s.jsx("div",{className:"col-xl-6 col-lg-12",children:i(e)},e.id)),l("Heatmap").map(e=>s.jsx("div",{className:"col-xl-12",children:i(e)},e.id))]})})]})})}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"card-header",children:[s.jsxs("h3",{className:"card-title",children:[s.jsx(_,{size:20,className:"me-2"}),"Detailed Data Tables"]}),s.jsx("div",{className:"card-subtitle text-muted",children:"Comprehensive data analysis and detailed breakdowns"})]}),s.jsx("div",{className:"card-body",children:s.jsx("div",{className:"row g-4",children:l("Table").map(e=>s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"mb-4",children:[s.jsxs("h5",{className:"text-muted mb-3",children:[e.title,s.jsx("span",{className:"badge bg-primary-lt ms-2",children:e.dashboard_name})]}),i(e)]})},e.id))})})]})})})]})}),s.jsx(H,{isOpen:F,onClose:()=>f(!1),dashboardId:"consolidated",dashboardName:"Consolidated Portfolio Analytics Dashboard",currentFilters:x})]})]})}export{js as default};
