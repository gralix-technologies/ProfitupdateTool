import{r as m,d as C,j as e,H as x}from"./app-BkeQkwCz.js";import{A as j}from"./AppLayout-QgBVyLMh.js";const k=({dashboard:r})=>{const[b,f]=m.useState({}),[c,_]=m.useState({}),[y,u]=m.useState(!0),[N,p]=m.useState(null);m.useEffect(()=>{h()},[]);const h=async()=>{try{u(!0),p(null);const s=await C.get(`/api/dashboards/${r.id}/data`);if(!s.data.success)throw new Error(s.data.message||"Failed to load dashboard data");const{dashboard:a,widget_data:t}=s.data.data,n={},d={};a.widgets.forEach(l=>{const i=t[l.id];if(i&&!i.error){if(l.type==="KPI"){const o=w(l);o&&(n[o]={value:i.value,format:i.format,color:i.color})}else if(l.type==="PieChart"||l.type==="BarChart"){const o=D(l);o&&i.data&&(d[o]=i.data)}}}),f(n),_(d)}catch(s){console.error("Error loading dashboard data:",s),p("Failed to load dashboard data: "+s.message)}finally{u(!1)}},w=s=>{const t=(s.configuration||{}).metric||"";return t.includes("SUM(outstanding_balance)")&&!t.includes("days_past_due")?"total_portfolio":t.includes("days_past_due >= 90")?"npl_ratio":t.includes("pd * lgd * ead")?"expected_loss":t.includes("interest_rate_annual")?"avg_interest_rate":null},D=s=>{const a=s.configuration||{};return s.type==="PieChart"&&a.group_by==="sector"?"sector_pie":s.type==="BarChart"&&a.x_axis==="credit_rating"?"rating_bar":null},g=(s,a)=>{if(!s&&s!==0)return"N/A";switch(a){case"currency":return"ZMW"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s);case"percentage":return s.toFixed(2)+"%";case"number":return new Intl.NumberFormat("en-US").format(s);default:return new Intl.NumberFormat("en-US").format(s)}},v=s=>({total_portfolio:"primary",npl_ratio:"danger",expected_loss:"warning",avg_interest_rate:"success"})[s]||"primary",F=s=>({total_portfolio:"Total Portfolio Value",npl_ratio:"NPL Ratio (PAR90+)",expected_loss:"Expected Loss",avg_interest_rate:"Avg Interest Rate"})[s]||s;return y?e.jsxs(j,{children:[e.jsx(x,{title:`Dashboard - ${r.name}`}),e.jsx("div",{className:"page-header",children:e.jsx("div",{className:"container-xl",children:e.jsx("div",{className:"row g-2 align-items-center",children:e.jsxs("div",{className:"col",children:[e.jsx("h2",{className:"page-title",children:r.name}),e.jsx("div",{className:"text-muted mt-1",children:r.description})]})})})}),e.jsx("div",{className:"page-body",children:e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"mt-2",children:"Loading dashboard data..."})]})})})]}):N?e.jsxs(j,{children:[e.jsx(x,{title:`Dashboard - ${r.name}`}),e.jsx("div",{className:"page-header",children:e.jsx("div",{className:"container-xl",children:e.jsx("div",{className:"row g-2 align-items-center",children:e.jsxs("div",{className:"col",children:[e.jsx("h2",{className:"page-title",children:r.name}),e.jsx("div",{className:"text-muted mt-1",children:r.description})]})})})}),e.jsx("div",{className:"page-body",children:e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("h4",{children:"Error Loading Dashboard"}),e.jsx("p",{children:N}),e.jsx("button",{className:"btn btn-outline-danger",onClick:h,children:"Retry"})]})})})]}):e.jsxs(j,{children:[e.jsx(x,{title:`Dashboard - ${r.name}`}),e.jsx("div",{className:"page-header",children:e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"row g-2 align-items-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("h2",{className:"page-title",children:r.name}),e.jsx("div",{className:"text-muted mt-1",children:r.description})]}),e.jsx("div",{className:"col-auto",children:e.jsxs("button",{className:"btn btn-outline-primary",onClick:h,children:[e.jsxs("svg",{className:"icon icon-tabler me-1",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",children:[e.jsx("path",{stroke:"none",d:"m0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"}),e.jsx("path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"})]}),"Refresh"]})})]})})}),e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"container-xl",children:[e.jsx("div",{className:"row row-deck row-cards mb-4",children:Object.entries(b).map(([s,a])=>e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("div",{className:"subheader",children:F(s)})}),e.jsx("div",{className:"h1 mb-3",children:e.jsx("span",{className:`text-${v(s)}`,children:g(a.value,a.format)})}),e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx("div",{className:"flex-fill",children:e.jsx("div",{className:"progress progress-sm",children:e.jsx("div",{className:`progress-bar bg-${v(s)}`,style:{width:`${Math.min(100,Math.max(0,a.value/(a.target||a.value*1.2)*100))}%`}})})}),e.jsxs("span",{className:"text-muted ms-2",children:[Math.min(100,Math.max(0,a.value/(a.target||a.value*1.2)*100)).toFixed(1),"%"]})]}),e.jsx("div",{className:"text-muted",children:a.target?`Target: ${g(a.target,a.format)}`:"Real-time data"})]})})},s))}),e.jsxs("div",{className:"row row-deck row-cards",children:[c.sector_pie&&e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Exposure by Sector"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sector"}),e.jsx("th",{className:"text-end",children:"Amount"}),e.jsx("th",{className:"text-end",children:"%"})]})}),e.jsx("tbody",{children:c.sector_pie.map((s,a)=>{const t=c.sector_pie.reduce((d,l)=>d+l.value,0),n=(s.value/t*100).toFixed(1);return e.jsxs("tr",{children:[e.jsx("td",{children:s.label}),e.jsxs("td",{className:"text-end",children:["ZMW",new Intl.NumberFormat().format(s.value)]}),e.jsxs("td",{className:"text-end",children:[n,"%"]})]},a)})})]})})})]})}),c.rating_bar&&e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Credit Rating Distribution"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Rating"}),e.jsx("th",{className:"text-end",children:"Count"}),e.jsx("th",{className:"text-end",children:"%"})]})}),e.jsx("tbody",{children:c.rating_bar.map((s,a)=>{const t=c.rating_bar.reduce((d,l)=>d+l.value,0),n=(s.value/t*100).toFixed(1);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary",children:s.label})}),e.jsx("td",{className:"text-end",children:s.value}),e.jsxs("td",{className:"text-end",children:[n,"%"]})]},a)})})]})})})]})})]})]})})]})};export{k as default};
