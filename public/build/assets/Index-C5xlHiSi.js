import{r,j as e,L as h,a as S}from"./app-BkeQkwCz.js";import{A as B,e as _,k as x}from"./AppLayout-QgBVyLMh.js";import{I as E}from"./IconPlus-Cs3MX6an.js";import{I as F}from"./IconFilter-DpaF_UhO.js";import{I as T}from"./IconSearch-qzSKrpRq.js";import{I as D}from"./IconTrendingUp-CoTcLOBw.js";import{I as M}from"./IconTrendingDown--I_y3ylQ.js";import{I as $}from"./IconEye-BLMw8FPn.js";function J({customers:a,filters:d,branches:z,riskLevels:A}){const[N,v]=r.useState(d.search||""),[g,b]=r.useState(d.branch_code||""),[f,y]=r.useState(d.risk_level||""),[w,C]=r.useState(d.is_active||"");r.useEffect(()=>{let s=null;const p=t=>{s&&(document.body.removeChild(s),s=null);const l=document.createElement("div");return l.className="custom-tooltip",l.textContent=t,l.style.cssText=`
                position: fixed;
                background: #333;
                color: white;
                padding: 8px 12px;
                border-radius: 4px;
                font-size: 12px;
                z-index: 99999;
                max-width: 350px;
                word-wrap: break-word;
                white-space: pre-line;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.2s ease;
            `,document.body.appendChild(l),s=l,l},L=(t,l)=>{const i=p(l),o=t.getBoundingClientRect();setTimeout(()=>{const m=i.getBoundingClientRect();let j=o.top-m.height-8,c=o.left+o.width/2-m.width/2;c<8&&(c=8),c+m.width>window.innerWidth-8&&(c=window.innerWidth-m.width-8),j<8&&(j=o.bottom+8),i.style.top=j+"px",i.style.left=c+"px",i.style.opacity="1"},10)},n=()=>{s&&(s.style.opacity="0",setTimeout(()=>{s&&document.body.contains(s)&&(document.body.removeChild(s),s=null)},200))},k=document.querySelectorAll("[data-tooltip]");return k.forEach(t=>{t.addEventListener("mouseenter",l=>{const i=l.target.getAttribute("data-tooltip");L(l.target,i)}),t.addEventListener("mouseleave",n),t.addEventListener("blur",n)}),document.addEventListener("mouseleave",n),()=>{k.forEach(t=>{t.removeEventListener("mouseenter",L),t.removeEventListener("mouseleave",n),t.removeEventListener("blur",n)}),document.removeEventListener("mouseleave",n),s&&document.body.contains(s)&&(document.body.removeChild(s),s=null)}},[a]);const I=()=>{S.get("/customers",{search:N,branch_code:g,risk_level:f,is_active:w},{preserveState:!0,replace:!0})},P=()=>{v(""),b(""),y(""),C(""),S.get("/customers")},R=s=>{switch(s){case"Low":return"bg-success";case"Medium":return"bg-warning";case"High":return"bg-danger";default:return"bg-secondary"}},u=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"ZMW",minimumFractionDigits:0,maximumFractionDigits:0}).format(s);return e.jsxs(B,{title:"Customer 360",children:[e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"row g-2 align-items-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"page-pretitle",children:"Customer Management"}),e.jsx("h2",{className:"page-title",children:"Customer 360"})]}),e.jsx("div",{className:"col-auto ms-auto d-print-none",children:e.jsx("div",{className:"btn-list",children:e.jsxs(h,{href:"/customers/create",className:"btn btn-primary d-none d-sm-inline-block",children:[e.jsx(E,{size:16,className:"me-1"}),"Add Customer"]})})})]})})}),e.jsx("div",{className:"page-body",children:e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"row row-deck row-cards",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title text-dark fw-bold",children:[e.jsx(F,{size:18,className:"me-2"}),"Search & Filter Customers"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3 align-items-end",children:[e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsxs("div",{className:"input-icon",children:[e.jsx("span",{className:"input-icon-addon",children:e.jsx(T,{size:16})}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Search customers...",value:N,onChange:s=>v(s.target.value),onKeyPress:s=>s.key==="Enter"&&I()})]})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"form-label",children:"Branch"}),e.jsxs("select",{className:"form-select",value:g,onChange:s=>b(s.target.value),children:[e.jsx("option",{value:"",children:"All Branches"}),z.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"form-label",children:"Risk Level"}),e.jsxs("select",{className:"form-select",value:f,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"All Risk Levels"}),A.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:w,onChange:s=>C(s.target.value),children:[e.jsx("option",{value:"",children:"All Customers"}),e.jsx("option",{value:"1",children:"Active Only"}),e.jsx("option",{value:"0",children:"Inactive Only"})]})]}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"btn-list",children:[e.jsxs("button",{className:"btn btn-primary",onClick:I,children:[e.jsx(T,{size:16,className:"me-1"}),"Search"]}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:P,children:"Clear"})]})})]})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"card-title text-dark fw-bold",children:[e.jsx(_,{size:18,className:"me-2"}),"Customers (",a.total,")"]})}),a.data&&a.data.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-vcenter card-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-1",children:"Customer"}),e.jsx("th",{className:"w-1",children:"Branch"}),e.jsx("th",{className:"w-1",children:e.jsxs("span",{className:"d-flex align-items-center",children:["Risk Level",e.jsx(x,{size:12,className:"ms-1 text-muted","data-tooltip":"Risk assessment based on NPL ratio:\\n• Low: <2% NPL ratio\\n• Medium: 2-5% NPL ratio\\n• High: >5% NPL ratio\\n\\nCalculated from customer's loan portfolio performance"})]})}),e.jsx("th",{className:"w-1",children:e.jsxs("span",{className:"d-flex align-items-center",children:["Profitability",e.jsx(x,{size:12,className:"ms-1 text-muted","data-tooltip":"Net annual profitability calculated as:\\nInterest Earned - Interest Paid - Operational Costs\\n\\n• Interest Earned: Loan amount × Interest rate (annual)\\n• Interest Paid: Deposit balance × Interest rate (annual, default 2%)\\n• Operational Costs: Base cost (50 per product) + loan management (150) + deposit maintenance (25) + NPL risk costs (0.1% of NPL exposure)"})]})}),e.jsx("th",{className:"w-1",children:e.jsxs("span",{className:"d-flex align-items-center",children:["Loans Outstanding",e.jsx(x,{size:12,className:"ms-1 text-muted","data-tooltip":"Total outstanding loan balances:\\nSum of 'amount' or 'outstanding_balance' fields from all products with category 'Loan'\\n\\nIncludes all active loans across the customer's portfolio"})]})}),e.jsx("th",{className:"w-1",children:e.jsxs("span",{className:"d-flex align-items-center",children:["Total Deposits",e.jsx(x,{size:12,className:"ms-1 text-muted","data-tooltip":"Total deposit account balances:\\nSum of 'amount' or 'balance' fields from all products with category 'Deposit' or 'Account'\\n\\nIncludes all active deposit accounts"})]})}),e.jsx("th",{className:"w-1",children:"Status"}),e.jsx("th",{className:"w-1",children:"Actions"})]})}),e.jsx("tbody",{children:a.data.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"avatar me-3 bg-primary text-white",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-fill",children:[e.jsx("div",{className:"font-weight-medium text-dark",children:s.name}),e.jsx("div",{className:"text-muted small",children:s.customer_id}),s.email&&e.jsx("div",{className:"text-muted small",children:s.email})]})]})}),e.jsx("td",{children:e.jsx("div",{className:"text-muted",children:s.branch_code||"N/A"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${R(s.risk_level)} text-white`,children:s.risk_level})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[s.profitability>=0?e.jsx(D,{size:16,className:"text-success me-1"}):e.jsx(M,{size:16,className:"text-danger me-1"}),e.jsx("span",{className:`fw-medium ${s.profitability>=0?"text-success":"text-danger"}`,children:u(s.profitability)})]})}),e.jsx("td",{children:e.jsx("div",{className:"text-muted fw-medium",children:u(s.total_loans_outstanding)})}),e.jsx("td",{children:e.jsx("div",{className:"text-muted fw-medium",children:u(s.total_deposits)})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.is_active?"bg-success":"bg-secondary"} text-white`,children:s.is_active?"Active":"Inactive"})}),e.jsx("td",{children:e.jsx(h,{href:`/customers/${s.id}`,className:"btn btn-primary btn-sm",children:e.jsx($,{size:16})})})]},s.id))})]})}):e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"empty",children:[e.jsx("div",{className:"empty-img",children:e.jsx(_,{size:48,className:"text-muted"})}),e.jsx("p",{className:"empty-title",children:"No customers found"}),e.jsx("p",{className:"empty-subtitle text-muted",children:"Try adjusting your search criteria or add new customers"}),e.jsx("div",{className:"empty-action",children:e.jsxs(h,{href:"/customers/create",className:"btn btn-primary",children:[e.jsx(E,{size:16,className:"me-1"}),"Add Customer"]})})]})}),a.links&&a.data&&a.data.length>0&&e.jsxs("div",{className:"card-footer d-flex align-items-center",children:[e.jsxs("p",{className:"m-0 text-muted",children:["Showing ",e.jsx("span",{children:a.from})," to ",e.jsx("span",{children:a.to})," of ",e.jsx("span",{children:a.total})," entries"]}),e.jsx("ul",{className:"pagination m-0 ms-auto",children:a.links.map((s,p)=>e.jsx("li",{className:`page-item ${s.active?"active":""} ${s.url?"":"disabled"}`,children:s.url?e.jsx(h,{href:s.url,className:"page-link",dangerouslySetInnerHTML:{__html:s.label}}):e.jsx("span",{className:"page-link",dangerouslySetInnerHTML:{__html:s.label}})},p))})]})]})})]})})})]})}export{J as default};
