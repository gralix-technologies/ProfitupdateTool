import{r as n,j as e}from"./app-BkeQkwCz.js";import{A as _,I as u,a as p,b as o,c as U}from"./AppLayout-QgBVyLMh.js";import{I as F}from"./IconDownload-DpSVhOrW.js";import{I as k}from"./IconRefresh-U6chIQJB.js";import{I as R}from"./IconFilter-DpaF_UhO.js";import{I as M}from"./IconSearch-qzSKrpRq.js";import{I as P}from"./IconCalendar-C52FWICz.js";import{I as $}from"./IconEye-BLMw8FPn.js";import{I as q}from"./IconTrash-DY-55J-g.js";import{I as B}from"./IconPlus-Cs3MX6an.js";function L({auditLogs:l,users:f,auth:G}){const[t,b]=n.useState(""),[c,w]=n.useState(""),[d,y]=n.useState(""),[i,I]=n.useState(""),[r,C]=n.useState(""),[m,S]=n.useState((l==null?void 0:l.data)||[]);n.useEffect(()=>{let s=(l==null?void 0:l.data)||[];t&&(s=s.filter(a=>{var x,h,j,N,v;return((h=(x=a.user)==null?void 0:x.name)==null?void 0:h.toLowerCase().includes(t.toLowerCase()))||((j=a.event)==null?void 0:j.toLowerCase().includes(t.toLowerCase()))||((N=a.auditable_type)==null?void 0:N.toLowerCase().includes(t.toLowerCase()))||((v=a.description)==null?void 0:v.toLowerCase().includes(t.toLowerCase()))})),c&&(s=s.filter(a=>a.user_id===parseInt(c))),d&&(s=s.filter(a=>a.event===d)),i&&(s=s.filter(a=>new Date(a.created_at)>=new Date(i))),r&&(s=s.filter(a=>new Date(a.created_at)<=new Date(r+"T23:59:59"))),S(s)},[t,c,d,i,r,l]);const g=s=>{switch(s){case"created":return"success";case"updated":return"warning";case"deleted":return"danger";default:return"secondary"}},z=s=>{switch(s){case"created":return e.jsx(B,{size:16});case"updated":return e.jsx(U,{size:16});case"deleted":return e.jsx(q,{size:16});default:return e.jsx(o,{size:16})}},D=s=>s?s.split("\\").pop():"Unknown",T=s=>new Date(s).toLocaleString(),A=()=>{const s=new URLSearchParams;c&&s.append("user_id",c),d&&s.append("event",d),i&&s.append("date_from",i),r&&s.append("date_to",r),window.open(`/admin/audit-trail/export?${s.toString()}`,"_blank")},E=()=>{window.location.reload()};return e.jsxs(_,{title:"Audit Trail",children:[e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-xl",children:e.jsxs("div",{className:"row g-2 align-items-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"page-pretitle",children:"Admin"}),e.jsx("h2",{className:"page-title",children:"Audit Trail"})]}),e.jsx("div",{className:"col-auto ms-auto d-print-none",children:e.jsxs("div",{className:"btn-list",children:[e.jsxs("button",{className:"btn btn-outline-primary",onClick:A,children:[e.jsx(F,{size:16,className:"me-1"}),"Export"]}),e.jsxs("button",{className:"btn btn-primary",onClick:E,children:[e.jsx(k,{size:16,className:"me-1"}),"Refresh"]})]})})]})})}),e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"container-xl",children:[e.jsxs("div",{className:"row row-deck row-cards mb-3",children:[e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"subheader",children:"Total Events"}),e.jsx("div",{className:"ms-auto",children:e.jsx(u,{size:24,className:"text-primary"})})]}),e.jsx("div",{className:"h1 mb-3",children:(l==null?void 0:l.total)||0}),e.jsx("div",{className:"d-flex mb-2",children:e.jsx("div",{className:"text-muted",children:"Audit entries"})})]})})}),e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"subheader",children:"Filtered Results"}),e.jsx("div",{className:"ms-auto",children:e.jsx(R,{size:24,className:"text-success"})})]}),e.jsx("div",{className:"h1 mb-3",children:m.length}),e.jsx("div",{className:"d-flex mb-2",children:e.jsx("div",{className:"text-muted",children:"Matching criteria"})})]})})}),e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"subheader",children:"Active Users"}),e.jsx("div",{className:"ms-auto",children:e.jsx(p,{size:24,className:"text-info"})})]}),e.jsx("div",{className:"h1 mb-3",children:new Set(m.map(s=>s.user_id)).size}),e.jsx("div",{className:"d-flex mb-2",children:e.jsx("div",{className:"text-muted",children:"Unique users"})})]})})}),e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"subheader",children:"Models Tracked"}),e.jsx("div",{className:"ms-auto",children:e.jsx(o,{size:24,className:"text-warning"})})]}),e.jsx("div",{className:"h1 mb-3",children:new Set(m.map(s=>s.auditable_type)).size}),e.jsx("div",{className:"d-flex mb-2",children:e.jsx("div",{className:"text-muted",children:"Different models"})})]})})})]}),e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Filter Audit Trail"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx(M,{size:16})}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Search events...",value:t,onChange:s=>b(s.target.value)})]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"User"}),e.jsxs("select",{className:"form-select",value:c,onChange:s=>w(s.target.value),children:[e.jsx("option",{value:"",children:"All Users"}),f.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Event Type"}),e.jsxs("select",{className:"form-select",value:d,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"All Events"}),e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"updated",children:"Updated"}),e.jsx("option",{value:"deleted",children:"Deleted"})]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Date From"}),e.jsx("input",{type:"date",className:"form-control",value:i,onChange:s=>I(s.target.value)})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Date To"}),e.jsx("input",{type:"date",className:"form-control",value:r,onChange:s=>C(s.target.value)})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Audit Trail"})}),e.jsx("div",{className:"card-body",children:m.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-vcenter card-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Event"}),e.jsx("th",{children:"Model"}),e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"IP Address"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m.map(s=>{var a,x;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(p,{size:16,className:"me-2 text-muted"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:((a=s.user)==null?void 0:a.name)||"System"}),((x=s.user)==null?void 0:x.email)&&e.jsx("div",{className:"text-muted small",children:s.user.email})]})]})}),e.jsx("td",{children:e.jsxs("span",{className:`badge bg-${g(s.event)}`,children:[e.jsx("span",{className:"me-1",children:z(s.event)}),s.event]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(o,{size:16,className:"me-2 text-muted"}),D(s.auditable_type)]})}),e.jsx("td",{children:e.jsxs("span",{className:"text-muted",children:["#",s.auditable_id]})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted small",children:s.description||"No description"})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(P,{size:16,className:"me-2 text-muted"}),e.jsx("span",{className:"text-muted small",children:T(s.created_at)})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted small",children:s.ip_address||"N/A"})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-outline-primary",children:e.jsx($,{size:16})})})]},s.id)})})]})}):e.jsxs("div",{className:"empty",children:[e.jsx("div",{className:"empty-img",children:e.jsx(u,{size:48,className:"text-muted"})}),e.jsx("p",{className:"empty-title",children:"No audit logs found"}),e.jsx("p",{className:"empty-subtitle text-muted",children:t||c||d||i||r?"Try adjusting your filters to see more results":"System activity will appear here as users interact with the system"})]})})]})]})})]})}export{L as default};
